{
  "type": "object",
  "required": [
    "datasets",
    "chart"
  ],
  "allOf": [
    {
      "title": "Source de données",
      "properties": {
        "datasets": {
          "type": "array",
          "items": [
            {
              "title": "Jeu de données",
              "description": "Ce jeu doit contenir au moins une colonne avec valeur numérique",
              "type": "object",
              "x-fromUrl": "api/v1/datasets?status=finalized&field-type=integer,number&q={q}&select=id,title&{context.datasetFilter}&sort=createdAt:-1",
              "x-itemsProp": "results",
              "x-itemTitle": "title",
              "x-itemKey": "href",
              "additionalProperties": false,
              "properties": {
                "href": {
                  "type": "string"
                },
                "title": {
                  "type": "string"
                },
                "id": {
                  "type": "string"
                },
                "finalizedAt": {
                  "type": "string"
                }
              }
            }
          ]
        },
        "staticFilters": {
          "title": "Filtres prédéfinis",
          "type": "array",
          "items": {
            "type": "object",
            "default": {
              "type": "in"
            },
            "x-itemKey": "type",
            "oneOf": [
              {
                "title": "Restreindre à des valeurs",
                "required": [
                  "field",
                  "values"
                ],
                "additionalProperties": false,
                "properties": {
                  "type": {
                    "const": "in"
                  },
                  "field": {
                    "type": "object",
                    "title": "Colonne de filtre",
                    "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                    "x-itemTitle": "label",
                    "x-itemKey": "key"
                  },
                  "values": {
                    "type": "array",
                    "title": "Valeurs",
                    "items": {
                      "type": "string"
                    },
                    "x-fromUrl": "{datasets.0.href}/values/{parent.value.field.key}?q={q}&q_mode=complete&size=100&stringify=true"
                  }
                }
              },
              {
                "title": "Restreindre à un interval de valeurs",
                "required": [
                  "field"
                ],
                "additionalProperties": false,
                "properties": {
                  "type": {
                    "const": "interval"
                  },
                  "field": {
                    "type": "object",
                    "title": "Colonne de filtre",
                    "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                    "x-itemTitle": "label",
                    "x-itemKey": "key"
                  },
                  "minValue": {
                    "type": "string",
                    "title": "Valeur min",
                    "x-fromUrl": "{datasets.0.href}/values/{parent.value.field.key}?q={q}&q_mode=complete&size=100&stringify=true"
                  },
                  "maxValue": {
                    "type": "string",
                    "title": "Valeur max",
                    "x-fromUrl": "{datasets.0.href}/values/{parent.value.field.key}?q={q}&q_mode=complete&size=100&stringify=true"
                  }
                }
              },
              {
                "title": "Exclure des valeurs",
                "required": [
                  "field",
                  "values"
                ],
                "additionalProperties": false,
                "properties": {
                  "type": {
                    "const": "out"
                  },
                  "field": {
                    "type": "object",
                    "title": "Colonne de filtre",
                    "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                    "x-itemTitle": "label",
                    "x-itemKey": "key"
                  },
                  "values": {
                    "type": "array",
                    "title": "Valeurs à exclure",
                    "items": {
                      "type": "string"
                    },
                    "x-fromUrl": "{datasets.0.href}/values/{parent.value.field.key}?q={q}&q_mode=complete&size=100&stringify=true"
                  }
                }
              }
            ]
          }
        },
        "qsFilter": {
          "type": "string",
          "x-display": "hidden",
          "default": ""
        }
      }
    },
    {
      "title": "Type de visualisation",
      "properties": {
        "chart": {
          "type": "object",
          "default": {
            "type": "line"
          },
          "required": [
            "type",
            "config"
          ],
          "oneOf": [
            {
              "title": "Courbe",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "line"
                },
                "tension": {
                  "type": "integer",
                  "title": "Courbure",
                  "minimum": 0,
                  "maximum": 4,
                  "default": 1,
                  "x-display": "slider"
                },
                "area": {
                  "type": "boolean",
                  "title": "Remplir l'aire en dessous",
                  "default": false
                },
                "yAxisStartsZero": {
                  "type": "boolean",
                  "title": "Commencer à partir de 0 pour l'axe des ordonnées"
                },
                "config": {
                  "type": "object",
                  "title": "Préparation des données",
                  "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
                  "oneOf": [
                    {
                      "title": "Lire les lignes une par une, couleur unique",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "size",
                        "labelsField",
                        "valuesField"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "rowsBased"
                        },
                        "labelsField": {
                          "type": "object",
                          "title": "Colonne de libellés",
                          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valuesField": {
                          "type": "string",
                          "title": "Colonne de valeurs",
                          "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "row",
                          "oneOf": [
                            {
                              "const": "row",
                              "title": "Ligne"
                            },
                            {
                              "const": "value",
                              "title": "Valeur"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "color": {
                          "type": "object",
                          "title": "Couleur",
                          "required": [
                            "type"
                          ],
                          "oneOf": [
                            {
                              "title": "Thème",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "theme"
                                },
                                "strValue": {
                                  "title": "Couleur",
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "primary",
                                      "title": "Primaire"
                                    },
                                    {
                                      "const": "secondary",
                                      "title": "Secondaire"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Personnalisée",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "custom"
                                },
                                "hexValue": {
                                  "type": "string",
                                  "title": "Couleur",
                                  "format": "hexcolor",
                                  "default": "#828282",
                                  "x-display": "color-picker"
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "theme",
                            "strValue": "primary"
                          }
                        }
                      }
                    },
                    {
                      "title": "Lire les lignes une par une, plusieurs couleurs",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "size",
                        "labelsField",
                        "valuesField"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "rowsBasedCategories"
                        },
                        "labelsField": {
                          "type": "object",
                          "title": "Colonne de libellés",
                          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valuesField": {
                          "type": "string",
                          "title": "Colonne de valeurs",
                          "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "categoriesField": {
                          "type": "string",
                          "title": "Champ de catégorie",
                          "x-if": "parent.parent.parent.parent.value.categorizable",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "row",
                          "oneOf": [
                            {
                              "const": "row",
                              "title": "Ligne"
                            },
                            {
                              "const": "value",
                              "title": "Valeur"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.categoriesField}&agg_size=12&size=0&qs={qsFilter}",
                                  "x-display": "list",
                                  "x-itemTitle": "value",
                                  "x-itemKey": "value",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "value"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "value": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "size",
                        "groupBy",
                        "valueCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBased"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valueCalc": {
                          "title": "Calcul de la valeur",
                          "type": "object",
                          "default": {
                            "type": "count"
                          },
                          "oneOf": [
                            {
                              "title": "Nombre de lignes",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "count"
                                }
                              }
                            },
                            {
                              "title": "Calcul depuis les valeurs d'une colonne",
                              "required": [
                                "field",
                                "metric"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "metric"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "metric": {
                                  "type": "string",
                                  "title": "Type de calcul",
                                  "default": "sum",
                                  "oneOf": [
                                    {
                                      "const": "avg",
                                      "title": "Moyenne"
                                    },
                                    {
                                      "const": "min",
                                      "title": "Valeur minimale"
                                    },
                                    {
                                      "const": "max",
                                      "title": "Valeur maximale"
                                    },
                                    {
                                      "const": "sum",
                                      "title": "Somme"
                                    }
                                  ]
                                },
                                "dynamicMetric": {
                                  "type": "boolean",
                                  "title": "Choix dynamique de la métrique",
                                  "default": false
                                }
                              }
                            }
                          ]
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "color": {
                          "type": "object",
                          "title": "Couleur",
                          "required": [
                            "type"
                          ],
                          "oneOf": [
                            {
                              "title": "Thème",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "theme"
                                },
                                "strValue": {
                                  "title": "Couleur",
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "primary",
                                      "title": "Primaire"
                                    },
                                    {
                                      "const": "secondary",
                                      "title": "Secondaire"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Personnalisée",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "custom"
                                },
                                "hexValue": {
                                  "type": "string",
                                  "title": "Couleur",
                                  "format": "hexcolor",
                                  "default": "#828282",
                                  "x-display": "color-picker"
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "theme",
                            "strValue": "primary"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "title": "Histogramme",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "bar",
                  "title": "Type de visualisation"
                },
                "categorizable": {
                  "const": "true"
                },
                "hideYAxis": {
                  "type": "boolean",
                  "title": "Cacher l'axe Y",
                  "description": "Les valeurs apparaitront au au dessus ou à droite des barres. Cache l'axe des X en affichage horizontal"
                },
                "horizontal": {
                  "type": "boolean",
                  "title": "Affichage horizontal"
                },
                "config": {
                  "type": "object",
                  "title": "Préparation des données",
                  "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
                  "oneOf": [
                    {
                      "title": "Lire les lignes une par une, couleur unique",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "size",
                        "labelsField",
                        "valuesField"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "rowsBased"
                        },
                        "labelsField": {
                          "type": "object",
                          "title": "Colonne de libellés",
                          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valuesField": {
                          "type": "string",
                          "title": "Colonne de valeurs",
                          "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "row",
                          "oneOf": [
                            {
                              "const": "row",
                              "title": "Ligne"
                            },
                            {
                              "const": "value",
                              "title": "Valeur"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "color": {
                          "type": "object",
                          "title": "Couleur",
                          "required": [
                            "type"
                          ],
                          "oneOf": [
                            {
                              "title": "Thème",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "theme"
                                },
                                "strValue": {
                                  "title": "Couleur",
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "primary",
                                      "title": "Primaire"
                                    },
                                    {
                                      "const": "secondary",
                                      "title": "Secondaire"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Personnalisée",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "custom"
                                },
                                "hexValue": {
                                  "type": "string",
                                  "title": "Couleur",
                                  "format": "hexcolor",
                                  "default": "#828282",
                                  "x-display": "color-picker"
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "theme",
                            "strValue": "primary"
                          }
                        }
                      }
                    },
                    {
                      "title": "Lire les lignes une par une, plusieurs couleurs",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "size",
                        "labelsField",
                        "valuesField"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "rowsBasedCategories"
                        },
                        "labelsField": {
                          "type": "object",
                          "title": "Colonne de libellés",
                          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valuesField": {
                          "type": "string",
                          "title": "Colonne de valeurs",
                          "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "categoriesField": {
                          "type": "string",
                          "title": "Champ de catégorie",
                          "x-if": "parent.parent.parent.parent.value.categorizable",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "row",
                          "oneOf": [
                            {
                              "const": "row",
                              "title": "Ligne"
                            },
                            {
                              "const": "value",
                              "title": "Valeur"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.categoriesField}&agg_size=12&size=0&qs={qsFilter}",
                                  "x-display": "list",
                                  "x-itemTitle": "value",
                                  "x-itemKey": "value",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "value"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "value": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "size",
                        "groupBy",
                        "valueCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBased"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valueCalc": {
                          "title": "Calcul de la valeur",
                          "type": "object",
                          "default": {
                            "type": "count"
                          },
                          "oneOf": [
                            {
                              "title": "Nombre de lignes",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "count"
                                }
                              }
                            },
                            {
                              "title": "Calcul depuis les valeurs d'une colonne",
                              "required": [
                                "field",
                                "metric"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "metric"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "metric": {
                                  "type": "string",
                                  "title": "Type de calcul",
                                  "default": "sum",
                                  "oneOf": [
                                    {
                                      "const": "avg",
                                      "title": "Moyenne"
                                    },
                                    {
                                      "const": "min",
                                      "title": "Valeur minimale"
                                    },
                                    {
                                      "const": "max",
                                      "title": "Valeur maximale"
                                    },
                                    {
                                      "const": "sum",
                                      "title": "Somme"
                                    }
                                  ]
                                },
                                "dynamicMetric": {
                                  "type": "boolean",
                                  "title": "Choix dynamique de la métrique",
                                  "default": false
                                }
                              }
                            }
                          ]
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "color": {
                          "type": "object",
                          "title": "Couleur",
                          "required": [
                            "type"
                          ],
                          "oneOf": [
                            {
                              "title": "Thème",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "theme"
                                },
                                "strValue": {
                                  "title": "Couleur",
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "primary",
                                      "title": "Primaire"
                                    },
                                    {
                                      "const": "secondary",
                                      "title": "Secondaire"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Personnalisée",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "custom"
                                },
                                "hexValue": {
                                  "type": "string",
                                  "title": "Couleur",
                                  "format": "hexcolor",
                                  "default": "#828282",
                                  "x-display": "color-picker"
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "theme",
                            "strValue": "primary"
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "title": "Plusieurs courbes",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "multi-line"
                },
                "tension": {
                  "type": "integer",
                  "title": "Courbure",
                  "minimum": 0,
                  "maximum": 4,
                  "default": 1,
                  "x-display": "slider"
                },
                "stacked": {
                  "type": "boolean",
                  "title": "Aires empilées"
                },
                "percentage": {
                  "type": "boolean",
                  "title": "Pourcentages",
                  "x-if": "parent.value.stacked"
                },
                "disableDynamicStack": {
                  "type": "boolean",
                  "title": "Désactiver la bascule d'empilement"
                },
                "config": {
                  "type": "object",
                  "title": "Préparation des données",
                  "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
                  "oneOf": [
                    {
                      "title": "Lire les lignes une par une",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "labelsField",
                        "valuesFields"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "rowsBased"
                        },
                        "labelsField": {
                          "type": "object",
                          "title": "Colonne de libellés",
                          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valuesFields": {
                          "type": "array",
                          "title": "Colonnes de valeurs",
                          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key",
                          "minItems": 1,
                          "maxItems": 12,
                          "items": {
                            "type": "object"
                          }
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "row",
                          "oneOf": [
                            {
                              "const": "row",
                              "title": "Ligne"
                            },
                            {
                              "const": "value",
                              "title": "Valeur"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromData": "parent.parent.parent.value.valuesFields",
                                  "x-display": "list",
                                  "x-itemTitle": "key",
                                  "x-itemKey": "key",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "key"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "key": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes, valeurs dans une seule colonne",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "groupBy",
                        "groupsField",
                        "valueCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBased"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "groupsField": {
                          "type": "object",
                          "title": "Grouper les valeurs en fonction de cette colonne",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valueCalc": {
                          "title": "Calcul de la valeur",
                          "type": "object",
                          "default": {
                            "type": "count"
                          },
                          "oneOf": [
                            {
                              "title": "Nombre de lignes",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "count"
                                }
                              }
                            },
                            {
                              "title": "Calcul depuis les valeurs d'une colonne",
                              "required": [
                                "field",
                                "metric"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "metric"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "metric": {
                                  "type": "string",
                                  "title": "Type de calcul",
                                  "default": "sum",
                                  "oneOf": [
                                    {
                                      "const": "avg",
                                      "title": "Moyenne"
                                    },
                                    {
                                      "const": "min",
                                      "title": "Valeur minimale"
                                    },
                                    {
                                      "const": "max",
                                      "title": "Valeur maximale"
                                    },
                                    {
                                      "const": "sum",
                                      "title": "Somme"
                                    }
                                  ]
                                },
                                "dynamicMetric": {
                                  "type": "boolean",
                                  "title": "Choix dynamique de la métrique",
                                  "default": false
                                }
                              }
                            }
                          ]
                        },
                        "missingLabel": {
                          "type": "string",
                          "title": "Libellé de groupe non renseigné",
                          "default": "Non renseigné"
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.groupsField.key}&agg_size=12&size=0&qs={qsFilter}&missing={parent.parent.parent.value.missingLabel}",
                                  "x-display": "list",
                                  "x-itemTitle": "value",
                                  "x-itemKey": "value",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "value"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "value": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes, valeurs dans plusieurs colonnes",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "groupBy",
                        "valuesCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBasedCategories"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "valuesCalc": {
                          "type": "array",
                          "title": "Colonnes de valeurs",
                          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key",
                          "minItems": 1,
                          "maxItems": 12,
                          "items": {
                            "type": "object"
                          }
                        },
                        "metric": {
                          "type": "string",
                          "title": "Type de calcul",
                          "default": "sum",
                          "oneOf": [
                            {
                              "const": "avg",
                              "title": "Moyenne"
                            },
                            {
                              "const": "min",
                              "title": "Valeur minimale"
                            },
                            {
                              "const": "max",
                              "title": "Valeur maximale"
                            },
                            {
                              "const": "sum",
                              "title": "Somme"
                            }
                          ]
                        },
                        "dynamicMetric": {
                          "type": "boolean",
                          "title": "Choix dynamique de la métrique",
                          "default": false
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromData": "parent.parent.parent.value.valuesCalc",
                                  "x-display": "list",
                                  "x-itemTitle": "key",
                                  "x-itemKey": "key",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "key"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "key": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "title": "Histogramme multivalué",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "multi-bar",
                  "title": "Type de visualisation"
                },
                "hideYAxis": {
                  "type": "boolean",
                  "title": "Cacher l'axe Y",
                  "description": "Les valeurs apparaitront au au dessus ou à droite des barres. Cache l'axe des X en affichage horizontal"
                },
                "horizontal": {
                  "type": "boolean",
                  "title": "Affichage horizontal"
                },
                "stacked": {
                  "type": "boolean",
                  "title": "Empiler les barres"
                },
                "percentage": {
                  "type": "boolean",
                  "title": "Pourcentages",
                  "x-if": "parent.value.stacked"
                },
                "disableDynamicStack": {
                  "type": "boolean",
                  "title": "Désactiver la bascule d'empilement"
                },
                "config": {
                  "type": "object",
                  "title": "Préparation des données",
                  "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
                  "oneOf": [
                    {
                      "title": "Lire les lignes une par une",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "labelsField",
                        "valuesFields"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "rowsBased"
                        },
                        "labelsField": {
                          "type": "object",
                          "title": "Colonne de libellés",
                          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valuesFields": {
                          "type": "array",
                          "title": "Colonnes de valeurs",
                          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key",
                          "minItems": 1,
                          "maxItems": 12,
                          "items": {
                            "type": "object"
                          }
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "row",
                          "oneOf": [
                            {
                              "const": "row",
                              "title": "Ligne"
                            },
                            {
                              "const": "value",
                              "title": "Valeur"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromData": "parent.parent.parent.value.valuesFields",
                                  "x-display": "list",
                                  "x-itemTitle": "key",
                                  "x-itemKey": "key",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "key"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "key": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes, valeurs dans une seule colonne",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "groupBy",
                        "groupsField",
                        "valueCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBased"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "groupsField": {
                          "type": "object",
                          "title": "Grouper les valeurs en fonction de cette colonne",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valueCalc": {
                          "title": "Calcul de la valeur",
                          "type": "object",
                          "default": {
                            "type": "count"
                          },
                          "oneOf": [
                            {
                              "title": "Nombre de lignes",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "count"
                                }
                              }
                            },
                            {
                              "title": "Calcul depuis les valeurs d'une colonne",
                              "required": [
                                "field",
                                "metric"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "metric"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "metric": {
                                  "type": "string",
                                  "title": "Type de calcul",
                                  "default": "sum",
                                  "oneOf": [
                                    {
                                      "const": "avg",
                                      "title": "Moyenne"
                                    },
                                    {
                                      "const": "min",
                                      "title": "Valeur minimale"
                                    },
                                    {
                                      "const": "max",
                                      "title": "Valeur maximale"
                                    },
                                    {
                                      "const": "sum",
                                      "title": "Somme"
                                    }
                                  ]
                                },
                                "dynamicMetric": {
                                  "type": "boolean",
                                  "title": "Choix dynamique de la métrique",
                                  "default": false
                                }
                              }
                            }
                          ]
                        },
                        "missingLabel": {
                          "type": "string",
                          "title": "Libellé de groupe non renseigné",
                          "default": "Non renseigné"
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.groupsField.key}&agg_size=12&size=0&qs={qsFilter}&missing={parent.parent.parent.value.missingLabel}",
                                  "x-display": "list",
                                  "x-itemTitle": "value",
                                  "x-itemKey": "value",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "value"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "value": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes, valeurs dans plusieurs colonnes",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "groupBy",
                        "valuesCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBasedCategories"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "valuesCalc": {
                          "type": "array",
                          "title": "Colonnes de valeurs",
                          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key",
                          "minItems": 1,
                          "maxItems": 12,
                          "items": {
                            "type": "object"
                          }
                        },
                        "metric": {
                          "type": "string",
                          "title": "Type de calcul",
                          "default": "sum",
                          "oneOf": [
                            {
                              "const": "avg",
                              "title": "Moyenne"
                            },
                            {
                              "const": "min",
                              "title": "Valeur minimale"
                            },
                            {
                              "const": "max",
                              "title": "Valeur maximale"
                            },
                            {
                              "const": "sum",
                              "title": "Somme"
                            }
                          ]
                        },
                        "dynamicMetric": {
                          "type": "boolean",
                          "title": "Choix dynamique de la métrique",
                          "default": false
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromData": "parent.parent.parent.value.valuesCalc",
                                  "x-display": "list",
                                  "x-itemTitle": "key",
                                  "x-itemKey": "key",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "key"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "key": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "title": "Radar",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "radar"
                },
                "tension": {
                  "type": "integer",
                  "title": "Courbure",
                  "minimum": 0,
                  "maximum": 4,
                  "default": 1,
                  "x-display": "slider"
                },
                "config": {
                  "type": "object",
                  "title": "Préparation des données",
                  "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
                  "oneOf": [
                    {
                      "title": "Lire les lignes une par une",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "labelsField",
                        "valuesFields"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "rowsBased"
                        },
                        "labelsField": {
                          "type": "object",
                          "title": "Colonne de libellés",
                          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valuesFields": {
                          "type": "array",
                          "title": "Colonnes de valeurs",
                          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key",
                          "minItems": 1,
                          "maxItems": 12,
                          "items": {
                            "type": "object"
                          }
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "row",
                          "oneOf": [
                            {
                              "const": "row",
                              "title": "Ligne"
                            },
                            {
                              "const": "value",
                              "title": "Valeur"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromData": "parent.parent.parent.value.valuesFields",
                                  "x-display": "list",
                                  "x-itemTitle": "key",
                                  "x-itemKey": "key",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "key"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "key": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes, valeurs dans une seule colonne",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "groupBy",
                        "groupsField",
                        "valueCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBased"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "groupsField": {
                          "type": "object",
                          "title": "Grouper les valeurs en fonction de cette colonne",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valueCalc": {
                          "title": "Calcul de la valeur",
                          "type": "object",
                          "default": {
                            "type": "count"
                          },
                          "oneOf": [
                            {
                              "title": "Nombre de lignes",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "count"
                                }
                              }
                            },
                            {
                              "title": "Calcul depuis les valeurs d'une colonne",
                              "required": [
                                "field",
                                "metric"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "metric"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "metric": {
                                  "type": "string",
                                  "title": "Type de calcul",
                                  "default": "sum",
                                  "oneOf": [
                                    {
                                      "const": "avg",
                                      "title": "Moyenne"
                                    },
                                    {
                                      "const": "min",
                                      "title": "Valeur minimale"
                                    },
                                    {
                                      "const": "max",
                                      "title": "Valeur maximale"
                                    },
                                    {
                                      "const": "sum",
                                      "title": "Somme"
                                    }
                                  ]
                                },
                                "dynamicMetric": {
                                  "type": "boolean",
                                  "title": "Choix dynamique de la métrique",
                                  "default": false
                                }
                              }
                            }
                          ]
                        },
                        "missingLabel": {
                          "type": "string",
                          "title": "Libellé de groupe non renseigné",
                          "default": "Non renseigné"
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.groupsField.key}&agg_size=12&size=0&qs={qsFilter}&missing={parent.parent.parent.value.missingLabel}",
                                  "x-display": "list",
                                  "x-itemTitle": "value",
                                  "x-itemKey": "value",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "value"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "value": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes, valeurs dans plusieurs colonnes",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "groupBy",
                        "valuesCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBasedCategories"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "valuesCalc": {
                          "type": "array",
                          "title": "Colonnes de valeurs",
                          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key",
                          "minItems": 1,
                          "maxItems": 12,
                          "items": {
                            "type": "object"
                          }
                        },
                        "metric": {
                          "type": "string",
                          "title": "Type de calcul",
                          "default": "sum",
                          "oneOf": [
                            {
                              "const": "avg",
                              "title": "Moyenne"
                            },
                            {
                              "const": "min",
                              "title": "Valeur minimale"
                            },
                            {
                              "const": "max",
                              "title": "Valeur maximale"
                            },
                            {
                              "const": "sum",
                              "title": "Somme"
                            }
                          ]
                        },
                        "dynamicMetric": {
                          "type": "boolean",
                          "title": "Choix dynamique de la métrique",
                          "default": false
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromData": "parent.parent.parent.value.valuesCalc",
                                  "x-display": "list",
                                  "x-itemTitle": "key",
                                  "x-itemKey": "key",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "key"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "key": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "title": "Camembert",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "pie"
                },
                "cutout": {
                  "type": "integer",
                  "title": "Trou au milieu",
                  "minimum": 0,
                  "maximum": 80,
                  "default": 0,
                  "x-display": "slider"
                },
                "config": {
                  "type": "object",
                  "title": "Préparation des données",
                  "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
                  "oneOf": [
                    {
                      "title": "Lire les lignes une par une",
                      "type": "object",
                      "required": [
                        "labelsField",
                        "valuesField"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "rowsBased"
                        },
                        "labelsField": {
                          "type": "object",
                          "title": "Colonne de libellés",
                          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 5,
                          "minimum": 1,
                          "maximum": 12
                        },
                        "valuesField": {
                          "type": "string",
                          "title": "Colonne de valeurs",
                          "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.labelsField.key}&agg_size=12&size=0&qs={qsFilter}",
                                  "x-display": "list",
                                  "x-itemTitle": "value",
                                  "x-itemKey": "value",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "value"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "value": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes",
                      "type": "object",
                      "required": [
                        "groupBy",
                        "valueCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBased"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 5,
                          "minimum": 1,
                          "maximum": 12
                        },
                        "valueCalc": {
                          "title": "Calcul de la valeur",
                          "type": "object",
                          "default": {
                            "type": "count"
                          },
                          "oneOf": [
                            {
                              "title": "Nombre de lignes",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "count"
                                }
                              }
                            },
                            {
                              "title": "Calcul depuis les valeurs d'une colonne",
                              "required": [
                                "field",
                                "metric"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "metric"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "metric": {
                                  "type": "string",
                                  "title": "Type de calcul",
                                  "default": "sum",
                                  "oneOf": [
                                    {
                                      "const": "avg",
                                      "title": "Moyenne"
                                    },
                                    {
                                      "const": "min",
                                      "title": "Valeur minimale"
                                    },
                                    {
                                      "const": "max",
                                      "title": "Valeur maximale"
                                    },
                                    {
                                      "const": "sum",
                                      "title": "Somme"
                                    }
                                  ]
                                },
                                "dynamicMetric": {
                                  "type": "boolean",
                                  "title": "Choix dynamique de la métrique",
                                  "default": false
                                }
                              }
                            }
                          ]
                        },
                        "missingLabel": {
                          "type": "string",
                          "title": "Libellé de groupe non renseigné",
                          "default": "Non renseigné"
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.groupBy.field.key}&interval={parent.parent.parent.value.groupBy.interval}&agg_size=12&size=0&qs={qsFilter}&missing={parent.parent.parent.value.missingLabel}",
                                  "x-display": "list",
                                  "x-itemTitle": "value",
                                  "x-itemKey": "value",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "value"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "value": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    }
                  ]
                }
              }
            },
            {
              "title": "Paire d'histogrammes",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "paired-histogram",
                  "title": "Type de visualisation"
                },
                "config": {
                  "type": "object",
                  "title": "Préparation des données",
                  "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
                  "oneOf": [
                    {
                      "title": "Lire les lignes une par une",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "labelsField",
                        "valuesFields"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "rowsBased"
                        },
                        "labelsField": {
                          "type": "object",
                          "title": "Colonne de libellés",
                          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valuesFields": {
                          "type": "array",
                          "title": "Colonnes de valeurs",
                          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key",
                          "minItems": 1,
                          "maxItems": 12,
                          "items": {
                            "type": "object"
                          }
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "row",
                          "oneOf": [
                            {
                              "const": "row",
                              "title": "Ligne"
                            },
                            {
                              "const": "value",
                              "title": "Valeur"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromData": "parent.parent.parent.value.valuesFields",
                                  "x-display": "list",
                                  "x-itemTitle": "key",
                                  "x-itemKey": "key",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "key"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "key": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes, valeurs dans une seule colonne",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "groupBy",
                        "groupsField",
                        "valueCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBased"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "groupsField": {
                          "type": "object",
                          "title": "Grouper les valeurs en fonction de cette colonne",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
                          "x-itemTitle": "label",
                          "x-itemKey": "key"
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "valueCalc": {
                          "title": "Calcul de la valeur",
                          "type": "object",
                          "default": {
                            "type": "count"
                          },
                          "oneOf": [
                            {
                              "title": "Nombre de lignes",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "count"
                                }
                              }
                            },
                            {
                              "title": "Calcul depuis les valeurs d'une colonne",
                              "required": [
                                "field",
                                "metric"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "metric"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "metric": {
                                  "type": "string",
                                  "title": "Type de calcul",
                                  "default": "sum",
                                  "oneOf": [
                                    {
                                      "const": "avg",
                                      "title": "Moyenne"
                                    },
                                    {
                                      "const": "min",
                                      "title": "Valeur minimale"
                                    },
                                    {
                                      "const": "max",
                                      "title": "Valeur maximale"
                                    },
                                    {
                                      "const": "sum",
                                      "title": "Somme"
                                    }
                                  ]
                                },
                                "dynamicMetric": {
                                  "type": "boolean",
                                  "title": "Choix dynamique de la métrique",
                                  "default": false
                                }
                              }
                            }
                          ]
                        },
                        "missingLabel": {
                          "type": "string",
                          "title": "Libellé de groupe non renseigné",
                          "default": "Non renseigné"
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.groupsField.key}&agg_size=12&size=0&qs={qsFilter}&missing={parent.parent.parent.value.missingLabel}",
                                  "x-display": "list",
                                  "x-itemTitle": "value",
                                  "x-itemKey": "value",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "value"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "value": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    },
                    {
                      "title": "Grouper les lignes, valeurs dans plusieurs colonnes",
                      "type": "object",
                      "required": [
                        "sortBy",
                        "sortOrder",
                        "groupBy",
                        "valuesCalc"
                      ],
                      "additionalProperties": false,
                      "properties": {
                        "type": {
                          "const": "aggsBasedCategories"
                        },
                        "groupBy": {
                          "type": "object",
                          "required": [
                            "type"
                          ],
                          "default": {
                            "type": "value"
                          },
                          "oneOf": [
                            {
                              "title": "Valeurs exactes d'une colonne",
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "value",
                                  "title": "Grouper par"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "const": ""
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne de type date",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "date"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "string",
                                  "title": "Taille des intervalles",
                                  "default": "day",
                                  "oneOf": [
                                    {
                                      "const": "hour",
                                      "title": "Heure"
                                    },
                                    {
                                      "const": "day",
                                      "title": "Jour"
                                    },
                                    {
                                      "const": "week",
                                      "title": "Semaine"
                                    },
                                    {
                                      "const": "month",
                                      "title": "Mois"
                                    },
                                    {
                                      "const": "year",
                                      "title": "Année"
                                    }
                                  ]
                                }
                              }
                            },
                            {
                              "title": "Intervalles d'une colonne numérique",
                              "required": [
                                "field",
                                "interval"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "number"
                                },
                                "field": {
                                  "type": "object",
                                  "title": "Grouper en fonction de cette colonne",
                                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                                  "x-itemTitle": "label",
                                  "x-itemKey": "key"
                                },
                                "interval": {
                                  "type": "integer",
                                  "title": "Taille des intervalles",
                                  "default": 100
                                }
                              }
                            }
                          ]
                        },
                        "valuesCalc": {
                          "type": "array",
                          "title": "Colonnes de valeurs",
                          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
                          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                          "x-itemTitle": "label",
                          "x-itemKey": "key",
                          "minItems": 1,
                          "maxItems": 12,
                          "items": {
                            "type": "object"
                          }
                        },
                        "metric": {
                          "type": "string",
                          "title": "Type de calcul",
                          "default": "sum",
                          "oneOf": [
                            {
                              "const": "avg",
                              "title": "Moyenne"
                            },
                            {
                              "const": "min",
                              "title": "Valeur minimale"
                            },
                            {
                              "const": "max",
                              "title": "Valeur maximale"
                            },
                            {
                              "const": "sum",
                              "title": "Somme"
                            }
                          ]
                        },
                        "dynamicMetric": {
                          "type": "boolean",
                          "title": "Choix dynamique de la métrique",
                          "default": false
                        },
                        "size": {
                          "type": "integer",
                          "title": "Nombre maximal d'élements",
                          "default": 10
                        },
                        "sortBy": {
                          "type": "string",
                          "title": "Trier par",
                          "default": "label",
                          "oneOf": [
                            {
                              "const": "value",
                              "title": "Valeur calculée"
                            },
                            {
                              "const": "label",
                              "title": "Libellé"
                            }
                          ]
                        },
                        "sortOrder": {
                          "type": "string",
                          "title": "Ordre",
                          "default": "asc",
                          "oneOf": [
                            {
                              "const": "asc",
                              "title": "Ascendant"
                            },
                            {
                              "const": "desc",
                              "title": "Descendant"
                            }
                          ]
                        },
                        "dynamicSort": {
                          "type": "boolean",
                          "title": "Trier dynamiquement",
                          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
                          "default": false
                        },
                        "colors": {
                          "type": "object",
                          "title": "Couleurs",
                          "oneOf": [
                            {
                              "title": "Palette précalculée",
                              "required": [
                                "type",
                                "name"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "palette"
                                },
                                "name": {
                                  "type": "string",
                                  "oneOf": [
                                    {
                                      "const": "Accent",
                                      "title": "Accent"
                                    },
                                    {
                                      "const": "Dark2",
                                      "title": "Foncé"
                                    },
                                    {
                                      "const": "Paired",
                                      "title": "Paires"
                                    },
                                    {
                                      "const": "Set1",
                                      "title": "Ensemble 1"
                                    },
                                    {
                                      "const": "Set2",
                                      "title": "Ensemble 2"
                                    },
                                    {
                                      "const": "Set3",
                                      "title": "Ensemble 3"
                                    },
                                    {
                                      "const": "Pastel1",
                                      "title": "Pastel 1"
                                    },
                                    {
                                      "const": "Pastel2",
                                      "title": "Pastel 2"
                                    }
                                  ],
                                  "default": "Accent"
                                },
                                "offset": {
                                  "type": "integer",
                                  "title": "Décallage",
                                  "default": 0
                                }
                              }
                            },
                            {
                              "title": "Palette personnalisée",
                              "required": [
                                "type",
                                "styles"
                              ],
                              "additionalProperties": false,
                              "properties": {
                                "type": {
                                  "const": "manual"
                                },
                                "styles": {
                                  "title": "Couleurs et ordre",
                                  "type": "array",
                                  "x-fromData": "parent.parent.parent.value.valuesCalc",
                                  "x-display": "list",
                                  "x-itemTitle": "key",
                                  "x-itemKey": "key",
                                  "x-itemsProp": "aggs",
                                  "items": {
                                    "type": "object",
                                    "required": [
                                      "key"
                                    ],
                                    "additionalProperties": false,
                                    "properties": {
                                      "key": {
                                        "type": "string",
                                        "x-display": "hidden"
                                      },
                                      "color": {
                                        "type": "string",
                                        "title": "Couleur",
                                        "format": "hexcolor",
                                        "default": "#828282",
                                        "x-display": "color-picker"
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          ],
                          "default": {
                            "type": "palette",
                            "name": "Accent",
                            "offset": 0
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    },
    {
      "title": "Options",
      "properties": {
        "title": {
          "title": "Titre du graphique",
          "type": "string"
        },
        "disableTooltip": {
          "type": "boolean",
          "title": "Désactiver l'infobulle",
          "default": false
        },
        "labelsMaxWidth": {
          "type": "integer",
          "title": "Longueur maximum des libellés",
          "minimum": 20,
          "maximum": 60,
          "default": 30,
          "x-display": "slider"
        },
        "unit": {
          "type": "string",
          "title": "Unité"
        },
        "divider": {
          "type": "number",
          "title": "Diviseur",
          "default": 1
        }
      }
    }
  ],
  "definitions": {
    "datasets": {
      "type": "array",
      "items": [
        {
          "title": "Jeu de données",
          "description": "Ce jeu doit contenir au moins une colonne avec valeur numérique",
          "type": "object",
          "x-fromUrl": "api/v1/datasets?status=finalized&field-type=integer,number&q={q}&select=id,title&{context.datasetFilter}&sort=createdAt:-1",
          "x-itemsProp": "results",
          "x-itemTitle": "title",
          "x-itemKey": "href",
          "additionalProperties": false,
          "properties": {
            "href": {
              "type": "string"
            },
            "title": {
              "type": "string"
            },
            "id": {
              "type": "string"
            },
            "finalizedAt": {
              "type": "string"
            }
          }
        }
      ]
    },
    "size": {
      "type": "integer",
      "title": "Nombre maximal d'élements",
      "default": 10
    },
    "horizontal": {
      "type": "boolean",
      "title": "Affichage horizontal"
    },
    "hideYAxis": {
      "type": "boolean",
      "title": "Cacher l'axe Y",
      "description": "Les valeurs apparaitront au au dessus ou à droite des barres. Cache l'axe des X en affichage horizontal"
    },
    "labelsField": {
      "type": "object",
      "title": "Colonne de libellés",
      "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
      "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
      "x-itemTitle": "label",
      "x-itemKey": "key"
    },
    "valuesField": {
      "type": "string",
      "title": "Colonne de valeurs",
      "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
      "x-itemTitle": "label",
      "x-itemKey": "key"
    },
    "valuesFields": {
      "type": "array",
      "title": "Colonnes de valeurs",
      "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
      "x-itemTitle": "label",
      "x-itemKey": "key",
      "minItems": 1,
      "maxItems": 12,
      "items": {
        "type": "object"
      }
    },
    "rowSort": {
      "type": "string",
      "title": "Trier par",
      "default": "row",
      "oneOf": [
        {
          "const": "row",
          "title": "Ligne"
        },
        {
          "const": "value",
          "title": "Valeur"
        },
        {
          "const": "label",
          "title": "Libellé"
        }
      ]
    },
    "aggSort": {
      "type": "string",
      "title": "Trier par",
      "default": "label",
      "oneOf": [
        {
          "const": "value",
          "title": "Valeur calculée"
        },
        {
          "const": "label",
          "title": "Libellé"
        }
      ]
    },
    "sortOrder": {
      "type": "string",
      "title": "Ordre",
      "default": "asc",
      "oneOf": [
        {
          "const": "asc",
          "title": "Ascendant"
        },
        {
          "const": "desc",
          "title": "Descendant"
        }
      ]
    },
    "dynamicSort": {
      "type": "boolean",
      "title": "Trier dynamiquement",
      "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
      "default": false
    },
    "tension": {
      "type": "integer",
      "title": "Courbure",
      "minimum": 0,
      "maximum": 4,
      "default": 1,
      "x-display": "slider"
    },
    "hexColor": {
      "type": "string",
      "title": "Couleur",
      "format": "hexcolor",
      "default": "#828282",
      "x-display": "color-picker"
    },
    "color": {
      "type": "object",
      "title": "Couleur",
      "required": [
        "type"
      ],
      "oneOf": [
        {
          "title": "Thème",
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "theme"
            },
            "strValue": {
              "title": "Couleur",
              "type": "string",
              "oneOf": [
                {
                  "const": "primary",
                  "title": "Primaire"
                },
                {
                  "const": "secondary",
                  "title": "Secondaire"
                }
              ]
            }
          }
        },
        {
          "title": "Personnalisée",
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "custom"
            },
            "hexValue": {
              "type": "string",
              "title": "Couleur",
              "format": "hexcolor",
              "default": "#828282",
              "x-display": "color-picker"
            }
          }
        }
      ],
      "default": {
        "type": "theme",
        "strValue": "primary"
      }
    },
    "groupBy": {
      "type": "object",
      "required": [
        "type"
      ],
      "default": {
        "type": "value"
      },
      "oneOf": [
        {
          "title": "Valeurs exactes d'une colonne",
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "value",
              "title": "Grouper par"
            },
            "field": {
              "type": "object",
              "title": "Grouper en fonction de cette colonne",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "interval": {
              "const": ""
            }
          }
        },
        {
          "title": "Intervalles d'une colonne de type date",
          "required": [
            "field",
            "interval"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "date"
            },
            "field": {
              "type": "object",
              "title": "Grouper en fonction de cette colonne",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "interval": {
              "type": "string",
              "title": "Taille des intervalles",
              "default": "day",
              "oneOf": [
                {
                  "const": "hour",
                  "title": "Heure"
                },
                {
                  "const": "day",
                  "title": "Jour"
                },
                {
                  "const": "week",
                  "title": "Semaine"
                },
                {
                  "const": "month",
                  "title": "Mois"
                },
                {
                  "const": "year",
                  "title": "Année"
                }
              ]
            }
          }
        },
        {
          "title": "Intervalles d'une colonne numérique",
          "required": [
            "field",
            "interval"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "number"
            },
            "field": {
              "type": "object",
              "title": "Grouper en fonction de cette colonne",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "interval": {
              "type": "integer",
              "title": "Taille des intervalles",
              "default": 100
            }
          }
        }
      ]
    },
    "valueCalc": {
      "title": "Calcul de la valeur",
      "type": "object",
      "default": {
        "type": "count"
      },
      "oneOf": [
        {
          "title": "Nombre de lignes",
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "count"
            }
          }
        },
        {
          "title": "Calcul depuis les valeurs d'une colonne",
          "required": [
            "field",
            "metric"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "metric"
            },
            "field": {
              "type": "object",
              "title": "Colonne",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "metric": {
              "type": "string",
              "title": "Type de calcul",
              "default": "sum",
              "oneOf": [
                {
                  "const": "avg",
                  "title": "Moyenne"
                },
                {
                  "const": "min",
                  "title": "Valeur minimale"
                },
                {
                  "const": "max",
                  "title": "Valeur maximale"
                },
                {
                  "const": "sum",
                  "title": "Somme"
                }
              ]
            },
            "dynamicMetric": {
              "type": "boolean",
              "title": "Choix dynamique de la métrique",
              "default": false
            }
          }
        }
      ]
    },
    "rowsDataSingle": {
      "title": "Lire les lignes une par une, couleur unique",
      "type": "object",
      "required": [
        "sortBy",
        "sortOrder",
        "size",
        "labelsField",
        "valuesField"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "rowsBased"
        },
        "labelsField": {
          "type": "object",
          "title": "Colonne de libellés",
          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
          "x-itemTitle": "label",
          "x-itemKey": "key"
        },
        "size": {
          "type": "integer",
          "title": "Nombre maximal d'élements",
          "default": 10
        },
        "valuesField": {
          "type": "string",
          "title": "Colonne de valeurs",
          "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
          "x-itemTitle": "label",
          "x-itemKey": "key"
        },
        "sortBy": {
          "type": "string",
          "title": "Trier par",
          "default": "row",
          "oneOf": [
            {
              "const": "row",
              "title": "Ligne"
            },
            {
              "const": "value",
              "title": "Valeur"
            },
            {
              "const": "label",
              "title": "Libellé"
            }
          ]
        },
        "sortOrder": {
          "type": "string",
          "title": "Ordre",
          "default": "asc",
          "oneOf": [
            {
              "const": "asc",
              "title": "Ascendant"
            },
            {
              "const": "desc",
              "title": "Descendant"
            }
          ]
        },
        "dynamicSort": {
          "type": "boolean",
          "title": "Trier dynamiquement",
          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
          "default": false
        },
        "color": {
          "type": "object",
          "title": "Couleur",
          "required": [
            "type"
          ],
          "oneOf": [
            {
              "title": "Thème",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "theme"
                },
                "strValue": {
                  "title": "Couleur",
                  "type": "string",
                  "oneOf": [
                    {
                      "const": "primary",
                      "title": "Primaire"
                    },
                    {
                      "const": "secondary",
                      "title": "Secondaire"
                    }
                  ]
                }
              }
            },
            {
              "title": "Personnalisée",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "custom"
                },
                "hexValue": {
                  "type": "string",
                  "title": "Couleur",
                  "format": "hexcolor",
                  "default": "#828282",
                  "x-display": "color-picker"
                }
              }
            }
          ],
          "default": {
            "type": "theme",
            "strValue": "primary"
          }
        }
      }
    },
    "rowsDataSingleCategories": {
      "title": "Lire les lignes une par une, plusieurs couleurs",
      "type": "object",
      "required": [
        "sortBy",
        "sortOrder",
        "size",
        "labelsField",
        "valuesField"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "rowsBasedCategories"
        },
        "labelsField": {
          "type": "object",
          "title": "Colonne de libellés",
          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
          "x-itemTitle": "label",
          "x-itemKey": "key"
        },
        "size": {
          "type": "integer",
          "title": "Nombre maximal d'élements",
          "default": 10
        },
        "valuesField": {
          "type": "string",
          "title": "Colonne de valeurs",
          "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
          "x-itemTitle": "label",
          "x-itemKey": "key"
        },
        "categoriesField": {
          "type": "string",
          "title": "Champ de catégorie",
          "x-if": "parent.parent.parent.parent.value.categorizable",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
          "x-itemTitle": "label",
          "x-itemKey": "key"
        },
        "sortBy": {
          "type": "string",
          "title": "Trier par",
          "default": "row",
          "oneOf": [
            {
              "const": "row",
              "title": "Ligne"
            },
            {
              "const": "value",
              "title": "Valeur"
            },
            {
              "const": "label",
              "title": "Libellé"
            }
          ]
        },
        "sortOrder": {
          "type": "string",
          "title": "Ordre",
          "default": "asc",
          "oneOf": [
            {
              "const": "asc",
              "title": "Ascendant"
            },
            {
              "const": "desc",
              "title": "Descendant"
            }
          ]
        },
        "dynamicSort": {
          "type": "boolean",
          "title": "Trier dynamiquement",
          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
          "default": false
        },
        "colors": {
          "type": "object",
          "title": "Couleurs",
          "oneOf": [
            {
              "title": "Palette précalculée",
              "required": [
                "type",
                "name"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "palette"
                },
                "name": {
                  "type": "string",
                  "oneOf": [
                    {
                      "const": "Accent",
                      "title": "Accent"
                    },
                    {
                      "const": "Dark2",
                      "title": "Foncé"
                    },
                    {
                      "const": "Paired",
                      "title": "Paires"
                    },
                    {
                      "const": "Set1",
                      "title": "Ensemble 1"
                    },
                    {
                      "const": "Set2",
                      "title": "Ensemble 2"
                    },
                    {
                      "const": "Set3",
                      "title": "Ensemble 3"
                    },
                    {
                      "const": "Pastel1",
                      "title": "Pastel 1"
                    },
                    {
                      "const": "Pastel2",
                      "title": "Pastel 2"
                    }
                  ],
                  "default": "Accent"
                },
                "offset": {
                  "type": "integer",
                  "title": "Décallage",
                  "default": 0
                }
              }
            },
            {
              "title": "Palette personnalisée",
              "required": [
                "type",
                "styles"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "manual"
                },
                "styles": {
                  "title": "Couleurs et ordre",
                  "type": "array",
                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.categoriesField}&agg_size=12&size=0&qs={qsFilter}",
                  "x-display": "list",
                  "x-itemTitle": "value",
                  "x-itemKey": "value",
                  "x-itemsProp": "aggs",
                  "items": {
                    "type": "object",
                    "required": [
                      "value"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "value": {
                        "type": "string",
                        "x-display": "hidden"
                      },
                      "color": {
                        "type": "string",
                        "title": "Couleur",
                        "format": "hexcolor",
                        "default": "#828282",
                        "x-display": "color-picker"
                      }
                    }
                  }
                }
              }
            }
          ],
          "default": {
            "type": "palette",
            "name": "Accent",
            "offset": 0
          }
        }
      }
    },
    "aggsDataSingle": {
      "title": "Grouper les lignes",
      "type": "object",
      "required": [
        "sortBy",
        "sortOrder",
        "size",
        "groupBy",
        "valueCalc"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "aggsBased"
        },
        "groupBy": {
          "type": "object",
          "required": [
            "type"
          ],
          "default": {
            "type": "value"
          },
          "oneOf": [
            {
              "title": "Valeurs exactes d'une colonne",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "value",
                  "title": "Grouper par"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "const": ""
                }
              }
            },
            {
              "title": "Intervalles d'une colonne de type date",
              "required": [
                "field",
                "interval"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "date"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "type": "string",
                  "title": "Taille des intervalles",
                  "default": "day",
                  "oneOf": [
                    {
                      "const": "hour",
                      "title": "Heure"
                    },
                    {
                      "const": "day",
                      "title": "Jour"
                    },
                    {
                      "const": "week",
                      "title": "Semaine"
                    },
                    {
                      "const": "month",
                      "title": "Mois"
                    },
                    {
                      "const": "year",
                      "title": "Année"
                    }
                  ]
                }
              }
            },
            {
              "title": "Intervalles d'une colonne numérique",
              "required": [
                "field",
                "interval"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "number"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "type": "integer",
                  "title": "Taille des intervalles",
                  "default": 100
                }
              }
            }
          ]
        },
        "size": {
          "type": "integer",
          "title": "Nombre maximal d'élements",
          "default": 10
        },
        "valueCalc": {
          "title": "Calcul de la valeur",
          "type": "object",
          "default": {
            "type": "count"
          },
          "oneOf": [
            {
              "title": "Nombre de lignes",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "count"
                }
              }
            },
            {
              "title": "Calcul depuis les valeurs d'une colonne",
              "required": [
                "field",
                "metric"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "metric"
                },
                "field": {
                  "type": "object",
                  "title": "Colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "metric": {
                  "type": "string",
                  "title": "Type de calcul",
                  "default": "sum",
                  "oneOf": [
                    {
                      "const": "avg",
                      "title": "Moyenne"
                    },
                    {
                      "const": "min",
                      "title": "Valeur minimale"
                    },
                    {
                      "const": "max",
                      "title": "Valeur maximale"
                    },
                    {
                      "const": "sum",
                      "title": "Somme"
                    }
                  ]
                },
                "dynamicMetric": {
                  "type": "boolean",
                  "title": "Choix dynamique de la métrique",
                  "default": false
                }
              }
            }
          ]
        },
        "sortBy": {
          "type": "string",
          "title": "Trier par",
          "default": "label",
          "oneOf": [
            {
              "const": "value",
              "title": "Valeur calculée"
            },
            {
              "const": "label",
              "title": "Libellé"
            }
          ]
        },
        "sortOrder": {
          "type": "string",
          "title": "Ordre",
          "default": "asc",
          "oneOf": [
            {
              "const": "asc",
              "title": "Ascendant"
            },
            {
              "const": "desc",
              "title": "Descendant"
            }
          ]
        },
        "dynamicSort": {
          "type": "boolean",
          "title": "Trier dynamiquement",
          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
          "default": false
        },
        "color": {
          "type": "object",
          "title": "Couleur",
          "required": [
            "type"
          ],
          "oneOf": [
            {
              "title": "Thème",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "theme"
                },
                "strValue": {
                  "title": "Couleur",
                  "type": "string",
                  "oneOf": [
                    {
                      "const": "primary",
                      "title": "Primaire"
                    },
                    {
                      "const": "secondary",
                      "title": "Secondaire"
                    }
                  ]
                }
              }
            },
            {
              "title": "Personnalisée",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "custom"
                },
                "hexValue": {
                  "type": "string",
                  "title": "Couleur",
                  "format": "hexcolor",
                  "default": "#828282",
                  "x-display": "color-picker"
                }
              }
            }
          ],
          "default": {
            "type": "theme",
            "strValue": "primary"
          }
        }
      }
    },
    "singleDataType": {
      "type": "object",
      "title": "Préparation des données",
      "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
      "oneOf": [
        {
          "title": "Lire les lignes une par une, couleur unique",
          "type": "object",
          "required": [
            "sortBy",
            "sortOrder",
            "size",
            "labelsField",
            "valuesField"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "rowsBased"
            },
            "labelsField": {
              "type": "object",
              "title": "Colonne de libellés",
              "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "size": {
              "type": "integer",
              "title": "Nombre maximal d'élements",
              "default": 10
            },
            "valuesField": {
              "type": "string",
              "title": "Colonne de valeurs",
              "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "sortBy": {
              "type": "string",
              "title": "Trier par",
              "default": "row",
              "oneOf": [
                {
                  "const": "row",
                  "title": "Ligne"
                },
                {
                  "const": "value",
                  "title": "Valeur"
                },
                {
                  "const": "label",
                  "title": "Libellé"
                }
              ]
            },
            "sortOrder": {
              "type": "string",
              "title": "Ordre",
              "default": "asc",
              "oneOf": [
                {
                  "const": "asc",
                  "title": "Ascendant"
                },
                {
                  "const": "desc",
                  "title": "Descendant"
                }
              ]
            },
            "dynamicSort": {
              "type": "boolean",
              "title": "Trier dynamiquement",
              "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
              "default": false
            },
            "color": {
              "type": "object",
              "title": "Couleur",
              "required": [
                "type"
              ],
              "oneOf": [
                {
                  "title": "Thème",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "theme"
                    },
                    "strValue": {
                      "title": "Couleur",
                      "type": "string",
                      "oneOf": [
                        {
                          "const": "primary",
                          "title": "Primaire"
                        },
                        {
                          "const": "secondary",
                          "title": "Secondaire"
                        }
                      ]
                    }
                  }
                },
                {
                  "title": "Personnalisée",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "custom"
                    },
                    "hexValue": {
                      "type": "string",
                      "title": "Couleur",
                      "format": "hexcolor",
                      "default": "#828282",
                      "x-display": "color-picker"
                    }
                  }
                }
              ],
              "default": {
                "type": "theme",
                "strValue": "primary"
              }
            }
          }
        },
        {
          "title": "Lire les lignes une par une, plusieurs couleurs",
          "type": "object",
          "required": [
            "sortBy",
            "sortOrder",
            "size",
            "labelsField",
            "valuesField"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "rowsBasedCategories"
            },
            "labelsField": {
              "type": "object",
              "title": "Colonne de libellés",
              "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "size": {
              "type": "integer",
              "title": "Nombre maximal d'élements",
              "default": 10
            },
            "valuesField": {
              "type": "string",
              "title": "Colonne de valeurs",
              "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "categoriesField": {
              "type": "string",
              "title": "Champ de catégorie",
              "x-if": "parent.parent.parent.parent.value.categorizable",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "sortBy": {
              "type": "string",
              "title": "Trier par",
              "default": "row",
              "oneOf": [
                {
                  "const": "row",
                  "title": "Ligne"
                },
                {
                  "const": "value",
                  "title": "Valeur"
                },
                {
                  "const": "label",
                  "title": "Libellé"
                }
              ]
            },
            "sortOrder": {
              "type": "string",
              "title": "Ordre",
              "default": "asc",
              "oneOf": [
                {
                  "const": "asc",
                  "title": "Ascendant"
                },
                {
                  "const": "desc",
                  "title": "Descendant"
                }
              ]
            },
            "dynamicSort": {
              "type": "boolean",
              "title": "Trier dynamiquement",
              "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
              "default": false
            },
            "colors": {
              "type": "object",
              "title": "Couleurs",
              "oneOf": [
                {
                  "title": "Palette précalculée",
                  "required": [
                    "type",
                    "name"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "palette"
                    },
                    "name": {
                      "type": "string",
                      "oneOf": [
                        {
                          "const": "Accent",
                          "title": "Accent"
                        },
                        {
                          "const": "Dark2",
                          "title": "Foncé"
                        },
                        {
                          "const": "Paired",
                          "title": "Paires"
                        },
                        {
                          "const": "Set1",
                          "title": "Ensemble 1"
                        },
                        {
                          "const": "Set2",
                          "title": "Ensemble 2"
                        },
                        {
                          "const": "Set3",
                          "title": "Ensemble 3"
                        },
                        {
                          "const": "Pastel1",
                          "title": "Pastel 1"
                        },
                        {
                          "const": "Pastel2",
                          "title": "Pastel 2"
                        }
                      ],
                      "default": "Accent"
                    },
                    "offset": {
                      "type": "integer",
                      "title": "Décallage",
                      "default": 0
                    }
                  }
                },
                {
                  "title": "Palette personnalisée",
                  "required": [
                    "type",
                    "styles"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "manual"
                    },
                    "styles": {
                      "title": "Couleurs et ordre",
                      "type": "array",
                      "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.categoriesField}&agg_size=12&size=0&qs={qsFilter}",
                      "x-display": "list",
                      "x-itemTitle": "value",
                      "x-itemKey": "value",
                      "x-itemsProp": "aggs",
                      "items": {
                        "type": "object",
                        "required": [
                          "value"
                        ],
                        "additionalProperties": false,
                        "properties": {
                          "value": {
                            "type": "string",
                            "x-display": "hidden"
                          },
                          "color": {
                            "type": "string",
                            "title": "Couleur",
                            "format": "hexcolor",
                            "default": "#828282",
                            "x-display": "color-picker"
                          }
                        }
                      }
                    }
                  }
                }
              ],
              "default": {
                "type": "palette",
                "name": "Accent",
                "offset": 0
              }
            }
          }
        },
        {
          "title": "Grouper les lignes",
          "type": "object",
          "required": [
            "sortBy",
            "sortOrder",
            "size",
            "groupBy",
            "valueCalc"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "aggsBased"
            },
            "groupBy": {
              "type": "object",
              "required": [
                "type"
              ],
              "default": {
                "type": "value"
              },
              "oneOf": [
                {
                  "title": "Valeurs exactes d'une colonne",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "value",
                      "title": "Grouper par"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "const": ""
                    }
                  }
                },
                {
                  "title": "Intervalles d'une colonne de type date",
                  "required": [
                    "field",
                    "interval"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "date"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "type": "string",
                      "title": "Taille des intervalles",
                      "default": "day",
                      "oneOf": [
                        {
                          "const": "hour",
                          "title": "Heure"
                        },
                        {
                          "const": "day",
                          "title": "Jour"
                        },
                        {
                          "const": "week",
                          "title": "Semaine"
                        },
                        {
                          "const": "month",
                          "title": "Mois"
                        },
                        {
                          "const": "year",
                          "title": "Année"
                        }
                      ]
                    }
                  }
                },
                {
                  "title": "Intervalles d'une colonne numérique",
                  "required": [
                    "field",
                    "interval"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "number"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "type": "integer",
                      "title": "Taille des intervalles",
                      "default": 100
                    }
                  }
                }
              ]
            },
            "size": {
              "type": "integer",
              "title": "Nombre maximal d'élements",
              "default": 10
            },
            "valueCalc": {
              "title": "Calcul de la valeur",
              "type": "object",
              "default": {
                "type": "count"
              },
              "oneOf": [
                {
                  "title": "Nombre de lignes",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "count"
                    }
                  }
                },
                {
                  "title": "Calcul depuis les valeurs d'une colonne",
                  "required": [
                    "field",
                    "metric"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "metric"
                    },
                    "field": {
                      "type": "object",
                      "title": "Colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "metric": {
                      "type": "string",
                      "title": "Type de calcul",
                      "default": "sum",
                      "oneOf": [
                        {
                          "const": "avg",
                          "title": "Moyenne"
                        },
                        {
                          "const": "min",
                          "title": "Valeur minimale"
                        },
                        {
                          "const": "max",
                          "title": "Valeur maximale"
                        },
                        {
                          "const": "sum",
                          "title": "Somme"
                        }
                      ]
                    },
                    "dynamicMetric": {
                      "type": "boolean",
                      "title": "Choix dynamique de la métrique",
                      "default": false
                    }
                  }
                }
              ]
            },
            "sortBy": {
              "type": "string",
              "title": "Trier par",
              "default": "label",
              "oneOf": [
                {
                  "const": "value",
                  "title": "Valeur calculée"
                },
                {
                  "const": "label",
                  "title": "Libellé"
                }
              ]
            },
            "sortOrder": {
              "type": "string",
              "title": "Ordre",
              "default": "asc",
              "oneOf": [
                {
                  "const": "asc",
                  "title": "Ascendant"
                },
                {
                  "const": "desc",
                  "title": "Descendant"
                }
              ]
            },
            "dynamicSort": {
              "type": "boolean",
              "title": "Trier dynamiquement",
              "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
              "default": false
            },
            "color": {
              "type": "object",
              "title": "Couleur",
              "required": [
                "type"
              ],
              "oneOf": [
                {
                  "title": "Thème",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "theme"
                    },
                    "strValue": {
                      "title": "Couleur",
                      "type": "string",
                      "oneOf": [
                        {
                          "const": "primary",
                          "title": "Primaire"
                        },
                        {
                          "const": "secondary",
                          "title": "Secondaire"
                        }
                      ]
                    }
                  }
                },
                {
                  "title": "Personnalisée",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "custom"
                    },
                    "hexValue": {
                      "type": "string",
                      "title": "Couleur",
                      "format": "hexcolor",
                      "default": "#828282",
                      "x-display": "color-picker"
                    }
                  }
                }
              ],
              "default": {
                "type": "theme",
                "strValue": "primary"
              }
            }
          }
        }
      ]
    },
    "rowsDataMultiple": {
      "title": "Lire les lignes une par une",
      "type": "object",
      "required": [
        "sortBy",
        "sortOrder",
        "labelsField",
        "valuesFields"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "rowsBased"
        },
        "labelsField": {
          "type": "object",
          "title": "Colonne de libellés",
          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
          "x-itemTitle": "label",
          "x-itemKey": "key"
        },
        "size": {
          "type": "integer",
          "title": "Nombre maximal d'élements",
          "default": 10
        },
        "valuesFields": {
          "type": "array",
          "title": "Colonnes de valeurs",
          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
          "x-itemTitle": "label",
          "x-itemKey": "key",
          "minItems": 1,
          "maxItems": 12,
          "items": {
            "type": "object"
          }
        },
        "sortBy": {
          "type": "string",
          "title": "Trier par",
          "default": "row",
          "oneOf": [
            {
              "const": "row",
              "title": "Ligne"
            },
            {
              "const": "value",
              "title": "Valeur"
            },
            {
              "const": "label",
              "title": "Libellé"
            }
          ]
        },
        "sortOrder": {
          "type": "string",
          "title": "Ordre",
          "default": "asc",
          "oneOf": [
            {
              "const": "asc",
              "title": "Ascendant"
            },
            {
              "const": "desc",
              "title": "Descendant"
            }
          ]
        },
        "dynamicSort": {
          "type": "boolean",
          "title": "Trier dynamiquement",
          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
          "default": false
        },
        "colors": {
          "type": "object",
          "title": "Couleurs",
          "oneOf": [
            {
              "title": "Palette précalculée",
              "required": [
                "type",
                "name"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "palette"
                },
                "name": {
                  "type": "string",
                  "oneOf": [
                    {
                      "const": "Accent",
                      "title": "Accent"
                    },
                    {
                      "const": "Dark2",
                      "title": "Foncé"
                    },
                    {
                      "const": "Paired",
                      "title": "Paires"
                    },
                    {
                      "const": "Set1",
                      "title": "Ensemble 1"
                    },
                    {
                      "const": "Set2",
                      "title": "Ensemble 2"
                    },
                    {
                      "const": "Set3",
                      "title": "Ensemble 3"
                    },
                    {
                      "const": "Pastel1",
                      "title": "Pastel 1"
                    },
                    {
                      "const": "Pastel2",
                      "title": "Pastel 2"
                    }
                  ],
                  "default": "Accent"
                },
                "offset": {
                  "type": "integer",
                  "title": "Décallage",
                  "default": 0
                }
              }
            },
            {
              "title": "Palette personnalisée",
              "required": [
                "type",
                "styles"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "manual"
                },
                "styles": {
                  "title": "Couleurs et ordre",
                  "type": "array",
                  "x-fromData": "parent.parent.parent.value.valuesFields",
                  "x-display": "list",
                  "x-itemTitle": "key",
                  "x-itemKey": "key",
                  "x-itemsProp": "aggs",
                  "items": {
                    "type": "object",
                    "required": [
                      "key"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "key": {
                        "type": "string",
                        "x-display": "hidden"
                      },
                      "color": {
                        "type": "string",
                        "title": "Couleur",
                        "format": "hexcolor",
                        "default": "#828282",
                        "x-display": "color-picker"
                      }
                    }
                  }
                }
              }
            }
          ],
          "default": {
            "type": "palette",
            "name": "Accent",
            "offset": 0
          }
        }
      }
    },
    "aggsDataMultiple": {
      "title": "Grouper les lignes, valeurs dans une seule colonne",
      "type": "object",
      "required": [
        "sortBy",
        "sortOrder",
        "groupBy",
        "groupsField",
        "valueCalc"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "aggsBased"
        },
        "groupBy": {
          "type": "object",
          "required": [
            "type"
          ],
          "default": {
            "type": "value"
          },
          "oneOf": [
            {
              "title": "Valeurs exactes d'une colonne",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "value",
                  "title": "Grouper par"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "const": ""
                }
              }
            },
            {
              "title": "Intervalles d'une colonne de type date",
              "required": [
                "field",
                "interval"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "date"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "type": "string",
                  "title": "Taille des intervalles",
                  "default": "day",
                  "oneOf": [
                    {
                      "const": "hour",
                      "title": "Heure"
                    },
                    {
                      "const": "day",
                      "title": "Jour"
                    },
                    {
                      "const": "week",
                      "title": "Semaine"
                    },
                    {
                      "const": "month",
                      "title": "Mois"
                    },
                    {
                      "const": "year",
                      "title": "Année"
                    }
                  ]
                }
              }
            },
            {
              "title": "Intervalles d'une colonne numérique",
              "required": [
                "field",
                "interval"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "number"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "type": "integer",
                  "title": "Taille des intervalles",
                  "default": 100
                }
              }
            }
          ]
        },
        "groupsField": {
          "type": "object",
          "title": "Grouper les valeurs en fonction de cette colonne",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
          "x-itemTitle": "label",
          "x-itemKey": "key"
        },
        "size": {
          "type": "integer",
          "title": "Nombre maximal d'élements",
          "default": 10
        },
        "valueCalc": {
          "title": "Calcul de la valeur",
          "type": "object",
          "default": {
            "type": "count"
          },
          "oneOf": [
            {
              "title": "Nombre de lignes",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "count"
                }
              }
            },
            {
              "title": "Calcul depuis les valeurs d'une colonne",
              "required": [
                "field",
                "metric"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "metric"
                },
                "field": {
                  "type": "object",
                  "title": "Colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "metric": {
                  "type": "string",
                  "title": "Type de calcul",
                  "default": "sum",
                  "oneOf": [
                    {
                      "const": "avg",
                      "title": "Moyenne"
                    },
                    {
                      "const": "min",
                      "title": "Valeur minimale"
                    },
                    {
                      "const": "max",
                      "title": "Valeur maximale"
                    },
                    {
                      "const": "sum",
                      "title": "Somme"
                    }
                  ]
                },
                "dynamicMetric": {
                  "type": "boolean",
                  "title": "Choix dynamique de la métrique",
                  "default": false
                }
              }
            }
          ]
        },
        "missingLabel": {
          "type": "string",
          "title": "Libellé de groupe non renseigné",
          "default": "Non renseigné"
        },
        "sortBy": {
          "type": "string",
          "title": "Trier par",
          "default": "label",
          "oneOf": [
            {
              "const": "value",
              "title": "Valeur calculée"
            },
            {
              "const": "label",
              "title": "Libellé"
            }
          ]
        },
        "sortOrder": {
          "type": "string",
          "title": "Ordre",
          "default": "asc",
          "oneOf": [
            {
              "const": "asc",
              "title": "Ascendant"
            },
            {
              "const": "desc",
              "title": "Descendant"
            }
          ]
        },
        "dynamicSort": {
          "type": "boolean",
          "title": "Trier dynamiquement",
          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
          "default": false
        },
        "colors": {
          "type": "object",
          "title": "Couleurs",
          "oneOf": [
            {
              "title": "Palette précalculée",
              "required": [
                "type",
                "name"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "palette"
                },
                "name": {
                  "type": "string",
                  "oneOf": [
                    {
                      "const": "Accent",
                      "title": "Accent"
                    },
                    {
                      "const": "Dark2",
                      "title": "Foncé"
                    },
                    {
                      "const": "Paired",
                      "title": "Paires"
                    },
                    {
                      "const": "Set1",
                      "title": "Ensemble 1"
                    },
                    {
                      "const": "Set2",
                      "title": "Ensemble 2"
                    },
                    {
                      "const": "Set3",
                      "title": "Ensemble 3"
                    },
                    {
                      "const": "Pastel1",
                      "title": "Pastel 1"
                    },
                    {
                      "const": "Pastel2",
                      "title": "Pastel 2"
                    }
                  ],
                  "default": "Accent"
                },
                "offset": {
                  "type": "integer",
                  "title": "Décallage",
                  "default": 0
                }
              }
            },
            {
              "title": "Palette personnalisée",
              "required": [
                "type",
                "styles"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "manual"
                },
                "styles": {
                  "title": "Couleurs et ordre",
                  "type": "array",
                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.groupsField.key}&agg_size=12&size=0&qs={qsFilter}&missing={parent.parent.parent.value.missingLabel}",
                  "x-display": "list",
                  "x-itemTitle": "value",
                  "x-itemKey": "value",
                  "x-itemsProp": "aggs",
                  "items": {
                    "type": "object",
                    "required": [
                      "value"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "value": {
                        "type": "string",
                        "x-display": "hidden"
                      },
                      "color": {
                        "type": "string",
                        "title": "Couleur",
                        "format": "hexcolor",
                        "default": "#828282",
                        "x-display": "color-picker"
                      }
                    }
                  }
                }
              }
            }
          ],
          "default": {
            "type": "palette",
            "name": "Accent",
            "offset": 0
          }
        }
      }
    },
    "aggsDataMultipleCategories": {
      "title": "Grouper les lignes, valeurs dans plusieurs colonnes",
      "type": "object",
      "required": [
        "sortBy",
        "sortOrder",
        "groupBy",
        "valuesCalc"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "aggsBasedCategories"
        },
        "groupBy": {
          "type": "object",
          "required": [
            "type"
          ],
          "default": {
            "type": "value"
          },
          "oneOf": [
            {
              "title": "Valeurs exactes d'une colonne",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "value",
                  "title": "Grouper par"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "const": ""
                }
              }
            },
            {
              "title": "Intervalles d'une colonne de type date",
              "required": [
                "field",
                "interval"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "date"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "type": "string",
                  "title": "Taille des intervalles",
                  "default": "day",
                  "oneOf": [
                    {
                      "const": "hour",
                      "title": "Heure"
                    },
                    {
                      "const": "day",
                      "title": "Jour"
                    },
                    {
                      "const": "week",
                      "title": "Semaine"
                    },
                    {
                      "const": "month",
                      "title": "Mois"
                    },
                    {
                      "const": "year",
                      "title": "Année"
                    }
                  ]
                }
              }
            },
            {
              "title": "Intervalles d'une colonne numérique",
              "required": [
                "field",
                "interval"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "number"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "type": "integer",
                  "title": "Taille des intervalles",
                  "default": 100
                }
              }
            }
          ]
        },
        "valuesCalc": {
          "type": "array",
          "title": "Colonnes de valeurs",
          "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
          "x-itemTitle": "label",
          "x-itemKey": "key",
          "minItems": 1,
          "maxItems": 12,
          "items": {
            "type": "object"
          }
        },
        "metric": {
          "type": "string",
          "title": "Type de calcul",
          "default": "sum",
          "oneOf": [
            {
              "const": "avg",
              "title": "Moyenne"
            },
            {
              "const": "min",
              "title": "Valeur minimale"
            },
            {
              "const": "max",
              "title": "Valeur maximale"
            },
            {
              "const": "sum",
              "title": "Somme"
            }
          ]
        },
        "dynamicMetric": {
          "type": "boolean",
          "title": "Choix dynamique de la métrique",
          "default": false
        },
        "size": {
          "type": "integer",
          "title": "Nombre maximal d'élements",
          "default": 10
        },
        "sortBy": {
          "type": "string",
          "title": "Trier par",
          "default": "label",
          "oneOf": [
            {
              "const": "value",
              "title": "Valeur calculée"
            },
            {
              "const": "label",
              "title": "Libellé"
            }
          ]
        },
        "sortOrder": {
          "type": "string",
          "title": "Ordre",
          "default": "asc",
          "oneOf": [
            {
              "const": "asc",
              "title": "Ascendant"
            },
            {
              "const": "desc",
              "title": "Descendant"
            }
          ]
        },
        "dynamicSort": {
          "type": "boolean",
          "title": "Trier dynamiquement",
          "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
          "default": false
        },
        "colors": {
          "type": "object",
          "title": "Couleurs",
          "oneOf": [
            {
              "title": "Palette précalculée",
              "required": [
                "type",
                "name"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "palette"
                },
                "name": {
                  "type": "string",
                  "oneOf": [
                    {
                      "const": "Accent",
                      "title": "Accent"
                    },
                    {
                      "const": "Dark2",
                      "title": "Foncé"
                    },
                    {
                      "const": "Paired",
                      "title": "Paires"
                    },
                    {
                      "const": "Set1",
                      "title": "Ensemble 1"
                    },
                    {
                      "const": "Set2",
                      "title": "Ensemble 2"
                    },
                    {
                      "const": "Set3",
                      "title": "Ensemble 3"
                    },
                    {
                      "const": "Pastel1",
                      "title": "Pastel 1"
                    },
                    {
                      "const": "Pastel2",
                      "title": "Pastel 2"
                    }
                  ],
                  "default": "Accent"
                },
                "offset": {
                  "type": "integer",
                  "title": "Décallage",
                  "default": 0
                }
              }
            },
            {
              "title": "Palette personnalisée",
              "required": [
                "type",
                "styles"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "manual"
                },
                "styles": {
                  "title": "Couleurs et ordre",
                  "type": "array",
                  "x-fromData": "parent.parent.parent.value.valuesCalc",
                  "x-display": "list",
                  "x-itemTitle": "key",
                  "x-itemKey": "key",
                  "x-itemsProp": "aggs",
                  "items": {
                    "type": "object",
                    "required": [
                      "key"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "key": {
                        "type": "string",
                        "x-display": "hidden"
                      },
                      "color": {
                        "type": "string",
                        "title": "Couleur",
                        "format": "hexcolor",
                        "default": "#828282",
                        "x-display": "color-picker"
                      }
                    }
                  }
                }
              }
            }
          ],
          "default": {
            "type": "palette",
            "name": "Accent",
            "offset": 0
          }
        }
      }
    },
    "multipleDataType": {
      "type": "object",
      "title": "Préparation des données",
      "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
      "oneOf": [
        {
          "title": "Lire les lignes une par une",
          "type": "object",
          "required": [
            "sortBy",
            "sortOrder",
            "labelsField",
            "valuesFields"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "rowsBased"
            },
            "labelsField": {
              "type": "object",
              "title": "Colonne de libellés",
              "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "size": {
              "type": "integer",
              "title": "Nombre maximal d'élements",
              "default": 10
            },
            "valuesFields": {
              "type": "array",
              "title": "Colonnes de valeurs",
              "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
              "x-itemTitle": "label",
              "x-itemKey": "key",
              "minItems": 1,
              "maxItems": 12,
              "items": {
                "type": "object"
              }
            },
            "sortBy": {
              "type": "string",
              "title": "Trier par",
              "default": "row",
              "oneOf": [
                {
                  "const": "row",
                  "title": "Ligne"
                },
                {
                  "const": "value",
                  "title": "Valeur"
                },
                {
                  "const": "label",
                  "title": "Libellé"
                }
              ]
            },
            "sortOrder": {
              "type": "string",
              "title": "Ordre",
              "default": "asc",
              "oneOf": [
                {
                  "const": "asc",
                  "title": "Ascendant"
                },
                {
                  "const": "desc",
                  "title": "Descendant"
                }
              ]
            },
            "dynamicSort": {
              "type": "boolean",
              "title": "Trier dynamiquement",
              "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
              "default": false
            },
            "colors": {
              "type": "object",
              "title": "Couleurs",
              "oneOf": [
                {
                  "title": "Palette précalculée",
                  "required": [
                    "type",
                    "name"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "palette"
                    },
                    "name": {
                      "type": "string",
                      "oneOf": [
                        {
                          "const": "Accent",
                          "title": "Accent"
                        },
                        {
                          "const": "Dark2",
                          "title": "Foncé"
                        },
                        {
                          "const": "Paired",
                          "title": "Paires"
                        },
                        {
                          "const": "Set1",
                          "title": "Ensemble 1"
                        },
                        {
                          "const": "Set2",
                          "title": "Ensemble 2"
                        },
                        {
                          "const": "Set3",
                          "title": "Ensemble 3"
                        },
                        {
                          "const": "Pastel1",
                          "title": "Pastel 1"
                        },
                        {
                          "const": "Pastel2",
                          "title": "Pastel 2"
                        }
                      ],
                      "default": "Accent"
                    },
                    "offset": {
                      "type": "integer",
                      "title": "Décallage",
                      "default": 0
                    }
                  }
                },
                {
                  "title": "Palette personnalisée",
                  "required": [
                    "type",
                    "styles"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "manual"
                    },
                    "styles": {
                      "title": "Couleurs et ordre",
                      "type": "array",
                      "x-fromData": "parent.parent.parent.value.valuesFields",
                      "x-display": "list",
                      "x-itemTitle": "key",
                      "x-itemKey": "key",
                      "x-itemsProp": "aggs",
                      "items": {
                        "type": "object",
                        "required": [
                          "key"
                        ],
                        "additionalProperties": false,
                        "properties": {
                          "key": {
                            "type": "string",
                            "x-display": "hidden"
                          },
                          "color": {
                            "type": "string",
                            "title": "Couleur",
                            "format": "hexcolor",
                            "default": "#828282",
                            "x-display": "color-picker"
                          }
                        }
                      }
                    }
                  }
                }
              ],
              "default": {
                "type": "palette",
                "name": "Accent",
                "offset": 0
              }
            }
          }
        },
        {
          "title": "Grouper les lignes, valeurs dans une seule colonne",
          "type": "object",
          "required": [
            "sortBy",
            "sortOrder",
            "groupBy",
            "groupsField",
            "valueCalc"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "aggsBased"
            },
            "groupBy": {
              "type": "object",
              "required": [
                "type"
              ],
              "default": {
                "type": "value"
              },
              "oneOf": [
                {
                  "title": "Valeurs exactes d'une colonne",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "value",
                      "title": "Grouper par"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "const": ""
                    }
                  }
                },
                {
                  "title": "Intervalles d'une colonne de type date",
                  "required": [
                    "field",
                    "interval"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "date"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "type": "string",
                      "title": "Taille des intervalles",
                      "default": "day",
                      "oneOf": [
                        {
                          "const": "hour",
                          "title": "Heure"
                        },
                        {
                          "const": "day",
                          "title": "Jour"
                        },
                        {
                          "const": "week",
                          "title": "Semaine"
                        },
                        {
                          "const": "month",
                          "title": "Mois"
                        },
                        {
                          "const": "year",
                          "title": "Année"
                        }
                      ]
                    }
                  }
                },
                {
                  "title": "Intervalles d'une colonne numérique",
                  "required": [
                    "field",
                    "interval"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "number"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "type": "integer",
                      "title": "Taille des intervalles",
                      "default": 100
                    }
                  }
                }
              ]
            },
            "groupsField": {
              "type": "object",
              "title": "Grouper les valeurs en fonction de cette colonne",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&maxCardinality=12",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "size": {
              "type": "integer",
              "title": "Nombre maximal d'élements",
              "default": 10
            },
            "valueCalc": {
              "title": "Calcul de la valeur",
              "type": "object",
              "default": {
                "type": "count"
              },
              "oneOf": [
                {
                  "title": "Nombre de lignes",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "count"
                    }
                  }
                },
                {
                  "title": "Calcul depuis les valeurs d'une colonne",
                  "required": [
                    "field",
                    "metric"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "metric"
                    },
                    "field": {
                      "type": "object",
                      "title": "Colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "metric": {
                      "type": "string",
                      "title": "Type de calcul",
                      "default": "sum",
                      "oneOf": [
                        {
                          "const": "avg",
                          "title": "Moyenne"
                        },
                        {
                          "const": "min",
                          "title": "Valeur minimale"
                        },
                        {
                          "const": "max",
                          "title": "Valeur maximale"
                        },
                        {
                          "const": "sum",
                          "title": "Somme"
                        }
                      ]
                    },
                    "dynamicMetric": {
                      "type": "boolean",
                      "title": "Choix dynamique de la métrique",
                      "default": false
                    }
                  }
                }
              ]
            },
            "missingLabel": {
              "type": "string",
              "title": "Libellé de groupe non renseigné",
              "default": "Non renseigné"
            },
            "sortBy": {
              "type": "string",
              "title": "Trier par",
              "default": "label",
              "oneOf": [
                {
                  "const": "value",
                  "title": "Valeur calculée"
                },
                {
                  "const": "label",
                  "title": "Libellé"
                }
              ]
            },
            "sortOrder": {
              "type": "string",
              "title": "Ordre",
              "default": "asc",
              "oneOf": [
                {
                  "const": "asc",
                  "title": "Ascendant"
                },
                {
                  "const": "desc",
                  "title": "Descendant"
                }
              ]
            },
            "dynamicSort": {
              "type": "boolean",
              "title": "Trier dynamiquement",
              "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
              "default": false
            },
            "colors": {
              "type": "object",
              "title": "Couleurs",
              "oneOf": [
                {
                  "title": "Palette précalculée",
                  "required": [
                    "type",
                    "name"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "palette"
                    },
                    "name": {
                      "type": "string",
                      "oneOf": [
                        {
                          "const": "Accent",
                          "title": "Accent"
                        },
                        {
                          "const": "Dark2",
                          "title": "Foncé"
                        },
                        {
                          "const": "Paired",
                          "title": "Paires"
                        },
                        {
                          "const": "Set1",
                          "title": "Ensemble 1"
                        },
                        {
                          "const": "Set2",
                          "title": "Ensemble 2"
                        },
                        {
                          "const": "Set3",
                          "title": "Ensemble 3"
                        },
                        {
                          "const": "Pastel1",
                          "title": "Pastel 1"
                        },
                        {
                          "const": "Pastel2",
                          "title": "Pastel 2"
                        }
                      ],
                      "default": "Accent"
                    },
                    "offset": {
                      "type": "integer",
                      "title": "Décallage",
                      "default": 0
                    }
                  }
                },
                {
                  "title": "Palette personnalisée",
                  "required": [
                    "type",
                    "styles"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "manual"
                    },
                    "styles": {
                      "title": "Couleurs et ordre",
                      "type": "array",
                      "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.groupsField.key}&agg_size=12&size=0&qs={qsFilter}&missing={parent.parent.parent.value.missingLabel}",
                      "x-display": "list",
                      "x-itemTitle": "value",
                      "x-itemKey": "value",
                      "x-itemsProp": "aggs",
                      "items": {
                        "type": "object",
                        "required": [
                          "value"
                        ],
                        "additionalProperties": false,
                        "properties": {
                          "value": {
                            "type": "string",
                            "x-display": "hidden"
                          },
                          "color": {
                            "type": "string",
                            "title": "Couleur",
                            "format": "hexcolor",
                            "default": "#828282",
                            "x-display": "color-picker"
                          }
                        }
                      }
                    }
                  }
                }
              ],
              "default": {
                "type": "palette",
                "name": "Accent",
                "offset": 0
              }
            }
          }
        },
        {
          "title": "Grouper les lignes, valeurs dans plusieurs colonnes",
          "type": "object",
          "required": [
            "sortBy",
            "sortOrder",
            "groupBy",
            "valuesCalc"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "aggsBasedCategories"
            },
            "groupBy": {
              "type": "object",
              "required": [
                "type"
              ],
              "default": {
                "type": "value"
              },
              "oneOf": [
                {
                  "title": "Valeurs exactes d'une colonne",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "value",
                      "title": "Grouper par"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "const": ""
                    }
                  }
                },
                {
                  "title": "Intervalles d'une colonne de type date",
                  "required": [
                    "field",
                    "interval"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "date"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "type": "string",
                      "title": "Taille des intervalles",
                      "default": "day",
                      "oneOf": [
                        {
                          "const": "hour",
                          "title": "Heure"
                        },
                        {
                          "const": "day",
                          "title": "Jour"
                        },
                        {
                          "const": "week",
                          "title": "Semaine"
                        },
                        {
                          "const": "month",
                          "title": "Mois"
                        },
                        {
                          "const": "year",
                          "title": "Année"
                        }
                      ]
                    }
                  }
                },
                {
                  "title": "Intervalles d'une colonne numérique",
                  "required": [
                    "field",
                    "interval"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "number"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "type": "integer",
                      "title": "Taille des intervalles",
                      "default": 100
                    }
                  }
                }
              ]
            },
            "valuesCalc": {
              "type": "array",
              "title": "Colonnes de valeurs",
              "description": "Choisissez les colonnes de valeurs numériques à présenter dans le graphique.",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
              "x-itemTitle": "label",
              "x-itemKey": "key",
              "minItems": 1,
              "maxItems": 12,
              "items": {
                "type": "object"
              }
            },
            "metric": {
              "type": "string",
              "title": "Type de calcul",
              "default": "sum",
              "oneOf": [
                {
                  "const": "avg",
                  "title": "Moyenne"
                },
                {
                  "const": "min",
                  "title": "Valeur minimale"
                },
                {
                  "const": "max",
                  "title": "Valeur maximale"
                },
                {
                  "const": "sum",
                  "title": "Somme"
                }
              ]
            },
            "dynamicMetric": {
              "type": "boolean",
              "title": "Choix dynamique de la métrique",
              "default": false
            },
            "size": {
              "type": "integer",
              "title": "Nombre maximal d'élements",
              "default": 10
            },
            "sortBy": {
              "type": "string",
              "title": "Trier par",
              "default": "label",
              "oneOf": [
                {
                  "const": "value",
                  "title": "Valeur calculée"
                },
                {
                  "const": "label",
                  "title": "Libellé"
                }
              ]
            },
            "sortOrder": {
              "type": "string",
              "title": "Ordre",
              "default": "asc",
              "oneOf": [
                {
                  "const": "asc",
                  "title": "Ascendant"
                },
                {
                  "const": "desc",
                  "title": "Descendant"
                }
              ]
            },
            "dynamicSort": {
              "type": "boolean",
              "title": "Trier dynamiquement",
              "description": "Si cette option est activée, l'utilisateur pourra choisir la colonne de tri et l'ordre de tri dans le formulaire de filtres interactifs.",
              "default": false
            },
            "colors": {
              "type": "object",
              "title": "Couleurs",
              "oneOf": [
                {
                  "title": "Palette précalculée",
                  "required": [
                    "type",
                    "name"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "palette"
                    },
                    "name": {
                      "type": "string",
                      "oneOf": [
                        {
                          "const": "Accent",
                          "title": "Accent"
                        },
                        {
                          "const": "Dark2",
                          "title": "Foncé"
                        },
                        {
                          "const": "Paired",
                          "title": "Paires"
                        },
                        {
                          "const": "Set1",
                          "title": "Ensemble 1"
                        },
                        {
                          "const": "Set2",
                          "title": "Ensemble 2"
                        },
                        {
                          "const": "Set3",
                          "title": "Ensemble 3"
                        },
                        {
                          "const": "Pastel1",
                          "title": "Pastel 1"
                        },
                        {
                          "const": "Pastel2",
                          "title": "Pastel 2"
                        }
                      ],
                      "default": "Accent"
                    },
                    "offset": {
                      "type": "integer",
                      "title": "Décallage",
                      "default": 0
                    }
                  }
                },
                {
                  "title": "Palette personnalisée",
                  "required": [
                    "type",
                    "styles"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "manual"
                    },
                    "styles": {
                      "title": "Couleurs et ordre",
                      "type": "array",
                      "x-fromData": "parent.parent.parent.value.valuesCalc",
                      "x-display": "list",
                      "x-itemTitle": "key",
                      "x-itemKey": "key",
                      "x-itemsProp": "aggs",
                      "items": {
                        "type": "object",
                        "required": [
                          "key"
                        ],
                        "additionalProperties": false,
                        "properties": {
                          "key": {
                            "type": "string",
                            "x-display": "hidden"
                          },
                          "color": {
                            "type": "string",
                            "title": "Couleur",
                            "format": "hexcolor",
                            "default": "#828282",
                            "x-display": "color-picker"
                          }
                        }
                      }
                    }
                  }
                }
              ],
              "default": {
                "type": "palette",
                "name": "Accent",
                "offset": 0
              }
            }
          }
        }
      ]
    },
    "rowsCategories": {
      "title": "Lire les lignes une par une",
      "type": "object",
      "required": [
        "labelsField",
        "valuesField"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "rowsBased"
        },
        "labelsField": {
          "type": "object",
          "title": "Colonne de libellés",
          "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
          "x-itemTitle": "label",
          "x-itemKey": "key"
        },
        "size": {
          "type": "integer",
          "title": "Nombre maximal d'élements",
          "default": 5,
          "minimum": 1,
          "maximum": 12
        },
        "valuesField": {
          "type": "string",
          "title": "Colonne de valeurs",
          "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
          "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
          "x-itemTitle": "label",
          "x-itemKey": "key"
        },
        "colors": {
          "type": "object",
          "title": "Couleurs",
          "oneOf": [
            {
              "title": "Palette précalculée",
              "required": [
                "type",
                "name"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "palette"
                },
                "name": {
                  "type": "string",
                  "oneOf": [
                    {
                      "const": "Accent",
                      "title": "Accent"
                    },
                    {
                      "const": "Dark2",
                      "title": "Foncé"
                    },
                    {
                      "const": "Paired",
                      "title": "Paires"
                    },
                    {
                      "const": "Set1",
                      "title": "Ensemble 1"
                    },
                    {
                      "const": "Set2",
                      "title": "Ensemble 2"
                    },
                    {
                      "const": "Set3",
                      "title": "Ensemble 3"
                    },
                    {
                      "const": "Pastel1",
                      "title": "Pastel 1"
                    },
                    {
                      "const": "Pastel2",
                      "title": "Pastel 2"
                    }
                  ],
                  "default": "Accent"
                },
                "offset": {
                  "type": "integer",
                  "title": "Décallage",
                  "default": 0
                }
              }
            },
            {
              "title": "Palette personnalisée",
              "required": [
                "type",
                "styles"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "manual"
                },
                "styles": {
                  "title": "Couleurs et ordre",
                  "type": "array",
                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.labelsField.key}&agg_size=12&size=0&qs={qsFilter}",
                  "x-display": "list",
                  "x-itemTitle": "value",
                  "x-itemKey": "value",
                  "x-itemsProp": "aggs",
                  "items": {
                    "type": "object",
                    "required": [
                      "value"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "value": {
                        "type": "string",
                        "x-display": "hidden"
                      },
                      "color": {
                        "type": "string",
                        "title": "Couleur",
                        "format": "hexcolor",
                        "default": "#828282",
                        "x-display": "color-picker"
                      }
                    }
                  }
                }
              }
            }
          ],
          "default": {
            "type": "palette",
            "name": "Accent",
            "offset": 0
          }
        }
      }
    },
    "aggsCategories": {
      "title": "Grouper les lignes",
      "type": "object",
      "required": [
        "groupBy",
        "valueCalc"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "aggsBased"
        },
        "groupBy": {
          "type": "object",
          "required": [
            "type"
          ],
          "default": {
            "type": "value"
          },
          "oneOf": [
            {
              "title": "Valeurs exactes d'une colonne",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "value",
                  "title": "Grouper par"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "const": ""
                }
              }
            },
            {
              "title": "Intervalles d'une colonne de type date",
              "required": [
                "field",
                "interval"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "date"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "type": "string",
                  "title": "Taille des intervalles",
                  "default": "day",
                  "oneOf": [
                    {
                      "const": "hour",
                      "title": "Heure"
                    },
                    {
                      "const": "day",
                      "title": "Jour"
                    },
                    {
                      "const": "week",
                      "title": "Semaine"
                    },
                    {
                      "const": "month",
                      "title": "Mois"
                    },
                    {
                      "const": "year",
                      "title": "Année"
                    }
                  ]
                }
              }
            },
            {
              "title": "Intervalles d'une colonne numérique",
              "required": [
                "field",
                "interval"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "number"
                },
                "field": {
                  "type": "object",
                  "title": "Grouper en fonction de cette colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "interval": {
                  "type": "integer",
                  "title": "Taille des intervalles",
                  "default": 100
                }
              }
            }
          ]
        },
        "size": {
          "type": "integer",
          "title": "Nombre maximal d'élements",
          "default": 5,
          "minimum": 1,
          "maximum": 12
        },
        "valueCalc": {
          "title": "Calcul de la valeur",
          "type": "object",
          "default": {
            "type": "count"
          },
          "oneOf": [
            {
              "title": "Nombre de lignes",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "count"
                }
              }
            },
            {
              "title": "Calcul depuis les valeurs d'une colonne",
              "required": [
                "field",
                "metric"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "metric"
                },
                "field": {
                  "type": "object",
                  "title": "Colonne",
                  "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                  "x-itemTitle": "label",
                  "x-itemKey": "key"
                },
                "metric": {
                  "type": "string",
                  "title": "Type de calcul",
                  "default": "sum",
                  "oneOf": [
                    {
                      "const": "avg",
                      "title": "Moyenne"
                    },
                    {
                      "const": "min",
                      "title": "Valeur minimale"
                    },
                    {
                      "const": "max",
                      "title": "Valeur maximale"
                    },
                    {
                      "const": "sum",
                      "title": "Somme"
                    }
                  ]
                },
                "dynamicMetric": {
                  "type": "boolean",
                  "title": "Choix dynamique de la métrique",
                  "default": false
                }
              }
            }
          ]
        },
        "missingLabel": {
          "type": "string",
          "title": "Libellé de groupe non renseigné",
          "default": "Non renseigné"
        },
        "colors": {
          "type": "object",
          "title": "Couleurs",
          "oneOf": [
            {
              "title": "Palette précalculée",
              "required": [
                "type",
                "name"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "palette"
                },
                "name": {
                  "type": "string",
                  "oneOf": [
                    {
                      "const": "Accent",
                      "title": "Accent"
                    },
                    {
                      "const": "Dark2",
                      "title": "Foncé"
                    },
                    {
                      "const": "Paired",
                      "title": "Paires"
                    },
                    {
                      "const": "Set1",
                      "title": "Ensemble 1"
                    },
                    {
                      "const": "Set2",
                      "title": "Ensemble 2"
                    },
                    {
                      "const": "Set3",
                      "title": "Ensemble 3"
                    },
                    {
                      "const": "Pastel1",
                      "title": "Pastel 1"
                    },
                    {
                      "const": "Pastel2",
                      "title": "Pastel 2"
                    }
                  ],
                  "default": "Accent"
                },
                "offset": {
                  "type": "integer",
                  "title": "Décallage",
                  "default": 0
                }
              }
            },
            {
              "title": "Palette personnalisée",
              "required": [
                "type",
                "styles"
              ],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "const": "manual"
                },
                "styles": {
                  "title": "Couleurs et ordre",
                  "type": "array",
                  "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.groupBy.field.key}&interval={parent.parent.parent.value.groupBy.interval}&agg_size=12&size=0&qs={qsFilter}&missing={parent.parent.parent.value.missingLabel}",
                  "x-display": "list",
                  "x-itemTitle": "value",
                  "x-itemKey": "value",
                  "x-itemsProp": "aggs",
                  "items": {
                    "type": "object",
                    "required": [
                      "value"
                    ],
                    "additionalProperties": false,
                    "properties": {
                      "value": {
                        "type": "string",
                        "x-display": "hidden"
                      },
                      "color": {
                        "type": "string",
                        "title": "Couleur",
                        "format": "hexcolor",
                        "default": "#828282",
                        "x-display": "color-picker"
                      }
                    }
                  }
                }
              }
            }
          ],
          "default": {
            "type": "palette",
            "name": "Accent",
            "offset": 0
          }
        }
      }
    },
    "categories": {
      "type": "object",
      "title": "Préparation des données",
      "description": "Choisissez la manière de traiter les données avant de les présenter dans un graphique.\n\n**lire les lignes une par une**:\nles valeurs sont lues directement depuis chaque ligne du jeu de données.\n\n**grouper les lignes et les compter**:\nles lignes du jeu de données sont groupées selon un critère et les valeurs affichées sont les nombres de lignes pour chaque groupe.\n\n**grouper les lignes et calculer des valeurs dans ces groupes**:\nles lignes du jeu de données sont groupées selon un critère puis les valeurs sont obtenues par calcul sur une colonne numérique pour chaque groupe (somme, moyenne, etc.)",
      "oneOf": [
        {
          "title": "Lire les lignes une par une",
          "type": "object",
          "required": [
            "labelsField",
            "valuesField"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "rowsBased"
            },
            "labelsField": {
              "type": "object",
              "title": "Colonne de libellés",
              "description": "Choisissez la colonne contenant les libellés à présenter en légende. Dans le cas d'un diagramme en ligne, cette colonne va correspondre aux valeurs présentées en abscisse.",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "size": {
              "type": "integer",
              "title": "Nombre maximal d'élements",
              "default": 5,
              "minimum": 1,
              "maximum": 12
            },
            "valuesField": {
              "type": "string",
              "title": "Colonne de valeurs",
              "description": "Choisissez une colonne de valeurs numériques à présenter dans le graphique.",
              "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
              "x-itemTitle": "label",
              "x-itemKey": "key"
            },
            "colors": {
              "type": "object",
              "title": "Couleurs",
              "oneOf": [
                {
                  "title": "Palette précalculée",
                  "required": [
                    "type",
                    "name"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "palette"
                    },
                    "name": {
                      "type": "string",
                      "oneOf": [
                        {
                          "const": "Accent",
                          "title": "Accent"
                        },
                        {
                          "const": "Dark2",
                          "title": "Foncé"
                        },
                        {
                          "const": "Paired",
                          "title": "Paires"
                        },
                        {
                          "const": "Set1",
                          "title": "Ensemble 1"
                        },
                        {
                          "const": "Set2",
                          "title": "Ensemble 2"
                        },
                        {
                          "const": "Set3",
                          "title": "Ensemble 3"
                        },
                        {
                          "const": "Pastel1",
                          "title": "Pastel 1"
                        },
                        {
                          "const": "Pastel2",
                          "title": "Pastel 2"
                        }
                      ],
                      "default": "Accent"
                    },
                    "offset": {
                      "type": "integer",
                      "title": "Décallage",
                      "default": 0
                    }
                  }
                },
                {
                  "title": "Palette personnalisée",
                  "required": [
                    "type",
                    "styles"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "manual"
                    },
                    "styles": {
                      "title": "Couleurs et ordre",
                      "type": "array",
                      "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.labelsField.key}&agg_size=12&size=0&qs={qsFilter}",
                      "x-display": "list",
                      "x-itemTitle": "value",
                      "x-itemKey": "value",
                      "x-itemsProp": "aggs",
                      "items": {
                        "type": "object",
                        "required": [
                          "value"
                        ],
                        "additionalProperties": false,
                        "properties": {
                          "value": {
                            "type": "string",
                            "x-display": "hidden"
                          },
                          "color": {
                            "type": "string",
                            "title": "Couleur",
                            "format": "hexcolor",
                            "default": "#828282",
                            "x-display": "color-picker"
                          }
                        }
                      }
                    }
                  }
                }
              ],
              "default": {
                "type": "palette",
                "name": "Accent",
                "offset": 0
              }
            }
          }
        },
        {
          "title": "Grouper les lignes",
          "type": "object",
          "required": [
            "groupBy",
            "valueCalc"
          ],
          "additionalProperties": false,
          "properties": {
            "type": {
              "const": "aggsBased"
            },
            "groupBy": {
              "type": "object",
              "required": [
                "type"
              ],
              "default": {
                "type": "value"
              },
              "oneOf": [
                {
                  "title": "Valeurs exactes d'une colonne",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "value",
                      "title": "Grouper par"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "const": ""
                    }
                  }
                },
                {
                  "title": "Intervalles d'une colonne de type date",
                  "required": [
                    "field",
                    "interval"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "date"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&format=date,date-time",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "type": "string",
                      "title": "Taille des intervalles",
                      "default": "day",
                      "oneOf": [
                        {
                          "const": "hour",
                          "title": "Heure"
                        },
                        {
                          "const": "day",
                          "title": "Jour"
                        },
                        {
                          "const": "week",
                          "title": "Semaine"
                        },
                        {
                          "const": "month",
                          "title": "Mois"
                        },
                        {
                          "const": "year",
                          "title": "Année"
                        }
                      ]
                    }
                  }
                },
                {
                  "title": "Intervalles d'une colonne numérique",
                  "required": [
                    "field",
                    "interval"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "number"
                    },
                    "field": {
                      "type": "object",
                      "title": "Grouper en fonction de cette colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "interval": {
                      "type": "integer",
                      "title": "Taille des intervalles",
                      "default": 100
                    }
                  }
                }
              ]
            },
            "size": {
              "type": "integer",
              "title": "Nombre maximal d'élements",
              "default": 5,
              "minimum": 1,
              "maximum": 12
            },
            "valueCalc": {
              "title": "Calcul de la valeur",
              "type": "object",
              "default": {
                "type": "count"
              },
              "oneOf": [
                {
                  "title": "Nombre de lignes",
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "count"
                    }
                  }
                },
                {
                  "title": "Calcul depuis les valeurs d'une colonne",
                  "required": [
                    "field",
                    "metric"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "metric"
                    },
                    "field": {
                      "type": "object",
                      "title": "Colonne",
                      "x-fromUrl": "{datasets.0.href}/schema?calculated=false&type=integer,number",
                      "x-itemTitle": "label",
                      "x-itemKey": "key"
                    },
                    "metric": {
                      "type": "string",
                      "title": "Type de calcul",
                      "default": "sum",
                      "oneOf": [
                        {
                          "const": "avg",
                          "title": "Moyenne"
                        },
                        {
                          "const": "min",
                          "title": "Valeur minimale"
                        },
                        {
                          "const": "max",
                          "title": "Valeur maximale"
                        },
                        {
                          "const": "sum",
                          "title": "Somme"
                        }
                      ]
                    },
                    "dynamicMetric": {
                      "type": "boolean",
                      "title": "Choix dynamique de la métrique",
                      "default": false
                    }
                  }
                }
              ]
            },
            "missingLabel": {
              "type": "string",
              "title": "Libellé de groupe non renseigné",
              "default": "Non renseigné"
            },
            "colors": {
              "type": "object",
              "title": "Couleurs",
              "oneOf": [
                {
                  "title": "Palette précalculée",
                  "required": [
                    "type",
                    "name"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "palette"
                    },
                    "name": {
                      "type": "string",
                      "oneOf": [
                        {
                          "const": "Accent",
                          "title": "Accent"
                        },
                        {
                          "const": "Dark2",
                          "title": "Foncé"
                        },
                        {
                          "const": "Paired",
                          "title": "Paires"
                        },
                        {
                          "const": "Set1",
                          "title": "Ensemble 1"
                        },
                        {
                          "const": "Set2",
                          "title": "Ensemble 2"
                        },
                        {
                          "const": "Set3",
                          "title": "Ensemble 3"
                        },
                        {
                          "const": "Pastel1",
                          "title": "Pastel 1"
                        },
                        {
                          "const": "Pastel2",
                          "title": "Pastel 2"
                        }
                      ],
                      "default": "Accent"
                    },
                    "offset": {
                      "type": "integer",
                      "title": "Décallage",
                      "default": 0
                    }
                  }
                },
                {
                  "title": "Palette personnalisée",
                  "required": [
                    "type",
                    "styles"
                  ],
                  "additionalProperties": false,
                  "properties": {
                    "type": {
                      "const": "manual"
                    },
                    "styles": {
                      "title": "Couleurs et ordre",
                      "type": "array",
                      "x-fromUrl": "{datasets.0.href}/values_agg?field={parent.parent.parent.value.groupBy.field.key}&interval={parent.parent.parent.value.groupBy.interval}&agg_size=12&size=0&qs={qsFilter}&missing={parent.parent.parent.value.missingLabel}",
                      "x-display": "list",
                      "x-itemTitle": "value",
                      "x-itemKey": "value",
                      "x-itemsProp": "aggs",
                      "items": {
                        "type": "object",
                        "required": [
                          "value"
                        ],
                        "additionalProperties": false,
                        "properties": {
                          "value": {
                            "type": "string",
                            "x-display": "hidden"
                          },
                          "color": {
                            "type": "string",
                            "title": "Couleur",
                            "format": "hexcolor",
                            "default": "#828282",
                            "x-display": "color-picker"
                          }
                        }
                      }
                    }
                  }
                }
              ],
              "default": {
                "type": "palette",
                "name": "Accent",
                "offset": 0
              }
            }
          }
        }
      ]
    },
    "filters": {
      "title": "Filtres prédéfinis",
      "type": "array",
      "items": {
        "type": "object",
        "default": {
          "type": "in"
        },
        "x-itemKey": "type",
        "oneOf": [
          {
            "title": "Restreindre à des valeurs",
            "required": [
              "field",
              "values"
            ],
            "additionalProperties": false,
            "properties": {
              "type": {
                "const": "in"
              },
              "field": {
                "type": "object",
                "title": "Colonne de filtre",
                "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                "x-itemTitle": "label",
                "x-itemKey": "key"
              },
              "values": {
                "type": "array",
                "title": "Valeurs",
                "items": {
                  "type": "string"
                },
                "x-fromUrl": "{datasets.0.href}/values/{parent.value.field.key}?q={q}&q_mode=complete&size=100&stringify=true"
              }
            }
          },
          {
            "title": "Restreindre à un interval de valeurs",
            "required": [
              "field"
            ],
            "additionalProperties": false,
            "properties": {
              "type": {
                "const": "interval"
              },
              "field": {
                "type": "object",
                "title": "Colonne de filtre",
                "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                "x-itemTitle": "label",
                "x-itemKey": "key"
              },
              "minValue": {
                "type": "string",
                "title": "Valeur min",
                "x-fromUrl": "{datasets.0.href}/values/{parent.value.field.key}?q={q}&q_mode=complete&size=100&stringify=true"
              },
              "maxValue": {
                "type": "string",
                "title": "Valeur max",
                "x-fromUrl": "{datasets.0.href}/values/{parent.value.field.key}?q={q}&q_mode=complete&size=100&stringify=true"
              }
            }
          },
          {
            "title": "Exclure des valeurs",
            "required": [
              "field",
              "values"
            ],
            "additionalProperties": false,
            "properties": {
              "type": {
                "const": "out"
              },
              "field": {
                "type": "object",
                "title": "Colonne de filtre",
                "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
                "x-itemTitle": "label",
                "x-itemKey": "key"
              },
              "values": {
                "type": "array",
                "title": "Valeurs à exclure",
                "items": {
                  "type": "string"
                },
                "x-fromUrl": "{datasets.0.href}/values/{parent.value.field.key}?q={q}&q_mode=complete&size=100&stringify=true"
              }
            }
          }
        ]
      }
    },
    "filterField": {
      "type": "object",
      "title": "Colonne de filtre",
      "x-fromUrl": "{datasets.0.href}/schema?calculated=false",
      "x-itemTitle": "label",
      "x-itemKey": "key"
    },
    "colorPalette": {
      "title": "Palette précalculée",
      "required": [
        "type",
        "name"
      ],
      "additionalProperties": false,
      "properties": {
        "type": {
          "const": "palette"
        },
        "name": {
          "type": "string",
          "oneOf": [
            {
              "const": "Accent",
              "title": "Accent"
            },
            {
              "const": "Dark2",
              "title": "Foncé"
            },
            {
              "const": "Paired",
              "title": "Paires"
            },
            {
              "const": "Set1",
              "title": "Ensemble 1"
            },
            {
              "const": "Set2",
              "title": "Ensemble 2"
            },
            {
              "const": "Set3",
              "title": "Ensemble 3"
            },
            {
              "const": "Pastel1",
              "title": "Pastel 1"
            },
            {
              "const": "Pastel2",
              "title": "Pastel 2"
            }
          ],
          "default": "Accent"
        },
        "offset": {
          "type": "integer",
          "title": "Décallage",
          "default": 0
        }
      }
    }
  }
}